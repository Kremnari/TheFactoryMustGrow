(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{"7jDb":function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var r=n("rOV7"),i=n("ztCj"),a=n("zYKg"),o=n("By/q");function c(e,t,n,r,i,a,o){try{var c=e[a](o),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,i)}function s(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){c(a,r,i,o,s,"next",e)}function s(e){c(a,r,i,o,s,"throw",e)}o(void 0)}))}}function u(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return f(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var d={tick_entities:[],object_tickers:{},game:{},objs:new Map,namedObjs:[],$_tags:new a.a,meta:{},ops:{},statics:{},metaDefines:{},Tick:function(e){for(var t,n=function(){var n=t.value,r=d.object_tickers[n.$_type].$_signalOrders;r?r.forEach((function(t){n.$_tags.has(t)&&d.object_tickers[n.$_type][t].fn(n,e,b)})):d.object_tickers[n.$_type].tick.fn(n,e,b)},r=u(d.tick_entities.values());!(t=r()).done;)n()},Tick_Builder:function(e){var t={};return Object.assign(t,e),t},IgorBuilder:m,config:{}},m={get data(){return d.data},newObject:function(e,t){var n={$_id:"id_"+d.objs.size,$_type:e,$_subType:t};return n.$_tags=Object(o.a)({to:d.$_tags,entity:n}),d.objs.set(n.$_id,n),n},newComponent:function(e,t){if(d.metaDefines[e]){var n=d.metaDefines[e].new(t,m.newObject(e,""),m),r=n[0];n[1];return d.object_tickers[e]&&d.tick_entities.push(r),r.$_id}return console.warn("cannot find object type"),!1}},p={initialize:function(e){d.ticker=new r.a(e.ticker.ticks_perSec,e.ticker.ticks_maxPhase),d.config.TICKS_PER_SECOND=e.ticker.ticks_perSec,d.statics["config.TICKS_PER_SECOND"]=e.ticker.ticks_perSec,p.Ticker=d.ticker,d.ticker_sub=d.ticker.subscribe(d.Tick),d.graphics=e.viewTasker,d.command=e.commandTasker,d.dbName=e.dbName,d.saveName=e.saveName,d.db=new i.a(d.dbName,"store"),d._provideTemp&&d._provideTemp.forEach((function(e){d.command.provide(e.item,e.fn,e.sig,e.valid)})),d._utilityTemp&&d._utilityTemp.forEach((function(e){return d.command.utilityFn(e.named,e.fn)}))},provide_CCC:function(e,t,n,r){
//! Provides temporary passthrough for game commands
d.command?d.command.provide(e,t,n,r):(d._provideTemp||(d._provideTemp=[]),d._provideTemp.push({item:e,fn:t,sig:n,valid:r}))},addUtility_CCC:function(e,t){d.command?d.command.utilityFn(e,t):(d._utilityTemp||(d._utilityTemp=[]),d._utilityTemp.push({named:e,fn:t}))},defineObj:function(e,t,n){d.metaDefines[e]={new:t,actions:n},(null==n?void 0:n.tick)&&(!d.object_tickers[e]&&(d.object_tickers[e]={}),d.object_tickers[e].tick={type:e,fn:n.tick}),n&&Object.entries(n).forEach((function(e){e[0];var t=e[1];t&&t.CC_provide&&p.provide_CCC(t.CC_provide,t,t.signature,t.validator),t&&t.Igor_operation&&p.addOperation(t.Igor_operation,t)}))},setStatic:function(e,t){Object.defineProperty(d.statics,e,{value:t,writable:!1})},addOperation:function(e,t){d.ops[e]={fn:t}},amendObject:function(e,t){},
//! I don't really like this implementation
addObjectTickHandler:function(e,t,n,r){!d.object_tickers[e]&&(d.object_tickers[e]={});var i=d.object_tickers[e];i[n]={type:e,fn:t,priority:r};var a=i.$_signalOrders||["tick"],o=a.findIndex((function(e){return"tick"==e}));r.chain?
//! Lots more needed for this...
[].splice.apply(a,[o,1].concat(r.chain)):r.num,i.$_signalOrders=a},loadDatabase:function(e){return s(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return d.data=e,t.next=3,Object(i.d)(d.saveName,d.db);case 3:d.save=t.sent,d.save?(d.game=JSON.parse(d.save.game),d.objs=new Map(JSON.parse(d.save.objs)),d.objs.forEach((function(e){e.$_tags=Object(o.a)({to:d.$_tags,entity:e,load:e.$_tags}),d.object_tickers[e.$_type]&&d.tick_entities.push(e)})),console.log("found save")):(d.game=d.metaDefines["#"].new,console.log("new game")),console.log("db loaded");case 6:case"end":return t.stop()}}),t)})))()},setNamed:function(e,t){d.namedObjs[e]=t},getObjId:function(e,t){return t?d.objs.get(d.objs.get(e)[t]):d.objs.get(e)},arrayFromIds:function(e){if(!e)return[];var t=[];return e.forEach((function(e){t.push(d.objs.get(e))})),t},getRunner:function(){return b},get globalObject(){return d.game},get dataSet(){return d.data},get:function(e,t){return d.objects_by_name()},saveGame:function(){var e={game:JSON.stringify(d.game),objs:JSON.stringify(Array.from(d.objs.entries()))};Object(i.f)(d.saveName,e,d.db)},setState:function(e){switch(e){case"start":d.ticker.resume();break;case"stop":d.ticker.pause();break;case"tick":d.ticker.once();break;case"toggle":d.ticker.toggle();break;default:console.warn("IGOR: setting unknown state")}},commands:function(e,t){return s(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=e,t.next="resetSave"===t.t0?3:6;break;case 3:return t.next=5,Object(i.c)(d.saveName,d.db);case 5:return t.abrupt("return",!0);case 6:case"end":return t.stop()}}),t)})))()}},b={emit:function(){},get data(){return d.data},get view(){return d.graphics},get config(){return d.config},processTEMP:function(e,t,n){var r={};return"string"==typeof e&&e.includes("id")&&(e=d.objs.get(e)),d.ops[t].fn(e,n,r,b,d.ops[t].fn),"_result"in r?r._result:r},getNamedObject:function(e){return d.namedObjs[e]},getId:function(e){return d.objs.get(e)},getStatic:function(e){return d.statics[e]},newComponent:function(e,t){if(d.metaDefines[e]){var n=d.metaDefines[e].new(t,m.newObject(e,""),m),r=n[0];n[1];return d.object_tickers[e]&&d.tick_entities.push(r),r.$_id}return console.warn("cannot find object type"),!1},addNewObject:function(e,t,n){if(d.metaDefines[t]){var r=d.metaDefines[t].new(n,m.newObject(t,""),m),i=r[0];r[1];return e.push(i.$_id),d.object_tickers[t]&&d.tick_entities.push(i),d.graphics.signaler.signal("addedEntity"),d.graphics.signaler.signal("generalUpdate"),!0}return console.warn("cannot find object type"),!1}};window.IgorCore=d},mUjK:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(){function e(){this.iconList={}}var t=e.prototype;return t.import=function(e){this.iconList=e;for(var t=0,n=Object.entries(this.iconList.tool);t<n.length;t++){var r=n[t],i=r[0],a=r[1];this.iconList.item[i]=a}},t.getSrc=function(e,t){if(!e)return"";if(e.indexOf("@")>-1&&!t){var n=e.split("@");e=n[0],t=n[1]}return this.iconList[e]&&this.iconList[e][t]||this.iconList.item[t]||null},e}()}}]);
//# sourceMappingURL=app~62866266.8254597d40c96aa44413.bundle.map