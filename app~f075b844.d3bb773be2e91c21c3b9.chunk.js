(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{0:function(t,e,i){i("GAND"),i("GmYv"),t.exports=i("b9nV")},"463H":function(t,e,i){"use strict";i.d(e,"b",(function(){return n})),i.d(e,"a",(function(){return r}));var n=30,r=60*n*5},BEPO:function(t){t.exports=JSON.parse('{"a":false,"b":false}')},EfK0:function(t,e,i){"use strict";i.d(e,"c",(function(){return s})),i.d(e,"b",(function(){return c})),i.d(e,"a",(function(){return u}));i("aurelia-event-aggregator");function n(t,e){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return r(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return r(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(i=t[Symbol.iterator]()).next.bind(i)}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var s=function(){function t(){this.itemList={}}var e=t.prototype;return e.import=function(t){var e=this;Object.entries(t).forEach((function(t){var i=t[0],n=t[1],r=new o(n);e.itemList[i]=r}))},e.get=function(t){return this.itemList[t]},e.incrementX=function(t){return++this.itemList[t].count},e.addNotifyX=function(t,e){var i;null==(i=this.itemList[t])||i.notifys.push(e)},t}(),o=function(t,e){this.isVisible=!1,this.isCraftable=!1,this.entity=!1,this.notifys=[],this.set_count_callbacks=["ItemNotifys"],Object.assign(this,t)},c=function(){function t(t,e){"string"==typeof t&&(this.name=t),"Object"==typeof t&&(this.name=t.name,this.item=t),this.count=e}return t.convert=function(e){return e.count?e:new t(e.name||e.item,e.amount)},t}(),u=function(){function t(t,e){void 0===e&&(e=0),this.items=Array.isArray(e)?e:new Array(e),this.itemMgr=t.item,this.recMgr=t.rec,this.signaler=t.signaler}var e=t.prototype;return e.serialize=function(){return this.items},e.deserialize=function(t){this.items=t},e[Symbol.iterator]=function(){return this.items},e.addAll=function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=1);for(var r,s=[],o=0,u=n(t);!(r=u()).done;){var a=r.value;(o=this.add(a.item||a.name,(a.amount||a.count)*i))>0&&s.push(new c(a.name||a.item,o))}if(e)return s},e.consumeAll=function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=1);for(var r,s=[],o=0,u=n(t);!(r=u()).done;){var a=r.value,f=c.convert(a);if(0==(o=this.consume(f.item||f.name,(f.count||f.amount)*i)))s.push(f);else if(e)return s.length>=1?this.addAll(s,!1,i):this.add(f.item,f.count-o),s=null,t}return[]},e.total=function(t){return this.items.reduce((function(e,i){return i&&i.name==t?e+i.count:e}),0)},e.add=function(t,e){if(0!=e){var i=this.itemMgr.get(t).stack_size,n=this._GetAddStack(t,i);if(!n)return e;var r=Math.min(i-n.count,e);return n.count+=r,e-r>0?this.add(t,e-r):0}},e.consume=function(t,e){var i=this._GetSubStack(t,!0),n=this.items[i];if(!n)return e;if(n.count-=e,n.count<0){var r=-1*n.count;return n.count=0,this.items[i]=void 0,this.consume(t,r)}return 0==n.count&&(this.items[i]=void 0),0},e._GetAddStack=function(t,e){for(var i=-1,n=0,r=[function(i){return i&&i.name==t&&i.count<e},function(t){return t&&0==t.count},function(t){return!t}];n<r.length;n++){var s=r[n];if((i=this.items.findIndex(s))>-1)break}return i>-1&&(!this.items[i]||this.items[i].name!=t)&&this.items.splice(i,1,{name:t,count:0}),this.items[i]},e._GetSubStack=function(t,e){void 0===e&&(e=!0);var i=this.items.length-1-this.items.slice().reverse().findIndex((function(e){return e&&e.name==t}));return e?i:this.items[i]},e.click=function(t){switch(t.what){case"use":var e=t.which.item||this.itemMgr.get(t.which.name);if(t.which.count>0&&e.hasEntity)return t.where.useItem(t.which.name)&&t.which.count--,void this.signaler.signal("addedEntity");break;case"move":var i=t.rounder.val,n=t.where.inv.consume(t.which.name,i),r=t.who.inv.add(t.which.name,i-n);t.where.inv.add(t.which.name,r)}},t}()},fcJs:function(t,e,i){"use strict";i.d(e,"a",(function(){return h})),i.d(e,"b",(function(){return g}));var n=i("By/q"),r=i("zYKg"),s=i("EfK0"),o=i("+Aae");function c(t,e){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return u(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return u(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(i=t[Symbol.iterator]()).next.bind(i)}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function a(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function f(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}o.a;var h=function(){function t(){this.entities_base={},this.entity_cats=[]}var e=t.prototype;return e.import=function(t,e){var i=this;this.itemMgr=e.item,this.techMgr=e.tech,Object.entries(t).forEach((function(t){var e=t[0],n=t[1];i.itemMgr.itemList[e]?(i.itemMgr.itemList[e].hasEntity=!0,i.entities_base[e]=n,n.crafting_categories&&n.crafting_categories.forEach((function(t){i.entity_cats[t]||(i.entity_cats[t]=[]),i.entity_cats[t].push(n.name)}))):console.warn("cannot locate  item for entity: "+e)})),Object.defineProperty(this,"avail_cats",{get:function(){var t=this,e=[];return Object.entries(this.entity_cats).forEach((function(i){var n=i[0];i[1].some((function(e){return t.itemMgr.itemList[e].count>0}))&&e.push(n)})),e}}),e.Ticker.DataProvider((function(t){i.TickerProvider(t)}))},e.TickerProvider=function(t){t.entities||(t.entities={}),t.entities.types||(t.entities.types=[]),t.entities.types.push("crafting"),t.entities.types.push("mining")},e.GenerateEntity=function(t,e,i){var n=this.entities_base[t];return n.resource_categories?new l(n,e,i):n.crafting_categories?new v(n,e,i):!!n.inputs&&new d(n,e,i)},e.RestoreEntity=function(t,e,i,n){var r=this.entities_base[t.name],s=null;return"mining"==t.type?(s=new l(r,e,i),""!=t.mining&&s.set_mining(n.res.resList[t.mining],t.mining_timer)):"crafting"==t.type?(s=new v(r,e,i),""!=t.recipe&&s.set_recipe(n.rec.recipeList[t.recipe],t.crafting_timer)):"lab"==t.type&&((s=new d(r,e,i)).research_timer=t.research_timer),s.restoreBuffers(t.buffers),s},e.set_player=function(t){this.player=t},e.upgrade=function(t){"buffers"==t.type?0==this.player.inv.consumeAll([new s.b("iron-chest",2)],!0).length?t.who.buffers[t.dir].max+=10:console.log("not enough...awesome"):"autoload"==t.type&&(0==this.player.inv.consumeAll([new s.b("burner-inserter",1)],!0).length?t.who.buffers[t.dir].xfer.count++:console.log("not enough...awesome"))},t}(),m=function(){function t(t,e,i,r){void 0===r&&(r=null),this.buffers={out:{max:5,qty:0,xfer:{timer:0,ticks:30,count:0}},in:{max:5,qty:0,xfer:{timer:0,ticks:30,count:0}}},Object.assign(this,t),this.inv=e,this.tags=Object(n.a)({to:i,entity:this}),r&&this.tags.push("type",r)}var e=t.prototype;return e.deserialize=function(t){throw new Error("Abstract method, please override")},e.serialize=function(){throw new Error("Abstract method, please override")},e.tick=function(t){console.warn("base entity ticked")},e.incrementBuffer=function(){return this.buffers.out.qty++,this.buffers.out.qty==this.buffers.out.max},e.restoreBuffers=function(t){this.buffers=t},t}(),l=function(t){function e(e,i,n){var r;return(r=t.call(this,e,i,n,"mining")||this).mining=null,r.buffers.in=void 0,r}f(e,t);var i=e.prototype;return i.deserialize=function(t){Object.assign(this,t)},i.serialize=function(){var t,e={};return e.name=this.name,e.type="mining",e.mining=(null==(t=this.mining)?void 0:t.name)||"",e.buffers=this.buffers,e.mining_timer=this.mining_timer,e},i.tick=function(t){var e=this.buffers.out.xfer;e.count>0&&++e.timer==e.ticks&&(this.collectBuffer(this,e.count),e.timer=0),this.mining&&this.buffers.out.qty!=this.buffers.out.max&&++this.mining_timer%16==0&&(this.buffers.out.qty++,this.mining_timer=0)},i.set_mining=function(t,e){var i=this;this.collectBuffer(),t!=this.mining?(this.mining=null,window.setTimeout((function(){i.mining=t,i.mining_time=t.mining_time/i.mining_speed*100,i.mining_timer=e||0}),0),this.tags.push("ticking","mining")):(this.mining=null,this.tags.delete("ticking"))},i.collectBuffer=function(t,e){void 0===t&&(t=this),void 0===e&&(e=this.buffers.out.qty),0!=this.buffers.out.qty&&(this.buffers.out.qty-=e-t.inv.add(this.mining.mining_results,e))},e}(m),v=function(t){function e(e,i,n){var r;return(r=t.call(this,e,i,n,"crafting")||this).recipe=null,r}f(e,t);var i,n,r,s=e.prototype;return s.tick=function(t){var e=this.buffers.in.xfer;e.count>0&&++e.timer==e.ticks&&(this.consumeIngs(),e.timer=0),(e=this.buffers.out.xfer).count>0&&++e.timer==e.ticks&&(this.collectBuffer(this,e.count),e.timer=0),this.recipe&&this.buffers.in.qty>0&&this.buffers.out.qty<this.buffers.out.max&&(this.crafting_timer++,this.crafting_timer%16==0&&(this.buffers.in.qty--,this.buffers.out.qty++,this.crafting_timer=0))},s.deserialize=function(t){Object.assign(this,t)},s.serialize=function(){var t,e={};return e.name=this.name,e.type="crafting",e.buffers=this.buffers,e.crafting_timer=this.crafting_timer,e.recipe=(null==(t=this.recipe)?void 0:t.name)||"",e},s.clear_recipe=function(){var t=this;if(this.buffers.in.qty>0)for(var e=1;e<=this.buffers.in.qty;e++)this.recipe.ingredients.forEach((function(e){t.inv.add(e.name,e.amount)}));this.collectBuffer(),this.tags.delete("ticking"),this.recipe=null},s.set_recipe=function(t,e){this.recipe&&this.clear_recipe(),this.recipe=t,this.crafting_time=t.crafting_speed/this.crafting_speed*100,this.crafting_timer=e||0,this.tags.push("ticking","crafting")},s.consumeIngs=function(t){if(this.recipe&&this.buffers.in.qty!=this.buffers.in.max){var e=this.inv.recMgr.canProduceMax(this.recipe,this.inv);if(0!=e){var i=(null==t?void 0:t.calc(this.buffers.in.qty,this.buffers.in.max,e))||1;this.inv.consumeAll(this.recipe.ingredients,!0,i),this.buffers.in.qty+=i}}},s.collectBuffer=function(t,e){void 0===t&&(t=this),void 0===e&&(e=this.buffers.out.qty);t.inv.addAll(this.recipe.results,!0,e);this.buffers.out.qty=0},i=e,(n=[{key:"canConsumeIngs",get:function(){return!0}}])&&a(i.prototype,n),r&&a(i,r),e}(m),d=function(t){function e(e,i,n){var r;return(r=t.call(this,e,i,n,"lab")||this).buffers.in={max:10,xfer:{timer:0,ticks:30,count:0}},r.buffers.out=void 0,r.inputs.forEach((function(t){return r.buffers.in[t]={qty:0}})),r.research_timer=NaN,r}f(e,t);var i=e.prototype;return i.deserialize=function(t){Object.assign(this,t)},i.serialize=function(){var t={};return t.name=this.name,t.type="lab",t.buffers=this.buffers,t.research_timer=this.research_timer,t},i.canAdd=function(t){return 0!=this.inv.total(t)&&this.buffers.in[t].qty!=this.buffers.in.max},i.addPotion=function(t,e){if(this.canAdd(t)){var i=e.calc(this.buffers.in[t].qty,this.buffers.in.max,this.inv.total(t));i-=this.inv.consume(t,i),this.buffers.in[t].qty+=i,this.tags.push("ticking","lab")}},i.tick=function(t){var e=this.buffers.in.xfer;if(e.count>0&&++e.timer==e.ticks){for(var i,n=NaN,r=c(this.inputs);!(i=r()).done;){var s=i.value;(n=this.buffers.in.max-this.buffers.in[s].qty)>0&&this.inv.consume(s,Math.min(e.count,n))}e.timer=0}t.mgrs.tech.researching&&(Number.isNaN(this.research_timer)&&this.nextUnit(t.mgrs.tech.nextIngredients),this.research_timer++,this.research_timer%16==0&&(t.mgrs.tech.increment_research(),this.research_timer=NaN))},i.nextUnit=function(t){var e=this;t.every((function(t){var i=t[0],n=t[1];return e.buffers.in[i].qty>=n}))?(t.forEach((function(t){var i=t[0],n=t[1];return e.buffers.in[i].qty-=n})),this.research_timer=0,this.tags.push("ticking","lab")):this.tags.delete("ticking")},e}(m),g=function(){function t(t,e){var i=this;this.entities=[],this.entityTags=new r.a,this.mgr=e.entity,this.parent=t.parent||t,o.a.Ticker.subscribe((function(t){i.tick(t)}))}var e=t.prototype;return e.deserialize=function(t,e){for(var i,n=null,r=c(t);!(i=r()).done;){var s=i.value;(n=this.mgr.RestoreEntity(s,this.parent.inv,this.entityTags,e)).parent=this.parent,this.entities.push(n)}},e.serialize=function(){var t=[];for(var e in this.entities)t[e]=this.entities[e].serialize();return t},e.AddEntity=function(t){var e=this.mgr.GenerateEntity(t,this.parent.inv,this.entityTags);e.parent=this.parent,this.entities.push(e)},e.tick=function(t,e){for(var i,n=c(t.entities.types);!(i=n()).done;){var r=i.value;this.entityTags.getSetValues("ticking",r).forEach((function(i){i.tick(t,e)}))}},t}()},mUjK:function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var n=function(){function t(){this.iconList={}}var e=t.prototype;return e.import=function(t){this.iconList=t;for(var e=0,i=Object.entries(this.iconList.tool);e<i.length;e++){var n=i[e],r=n[0],s=n[1];this.iconList.item[r]=s}},e.getSrc=function(t,e){var i;if(!t)return"";if(t.indexOf("@")>-1&&!e){var n=t.split("@");t=n[0],e=n[1]}return(null==(i=this.iconList[t])?void 0:i[e])?this.iconList[t][e]:null},e.restoreIcons=function(t){var e=this;return Object.values(t).forEach((function(t){var i;if(t.icon){var n=t.icon.split("@"),r=n[0],s=n[1];t.icon=(null==(i=e.iconList[r])?void 0:i[s])||e.iconList.item[s]}})),t},t}()},uShe:function(t,e,i){"use strict";function n(t,e,i,n,r,s,o){try{var c=t[s](o),u=c.value}catch(t){return void i(t)}c.done?e(u):Promise.resolve(u).then(n,r)}function r(t){return function(){var e=this,i=arguments;return new Promise((function(r,s){var o=t.apply(e,i);function c(t){n(o,r,s,c,u,"next",t)}function u(t){n(o,r,s,c,u,"throw",t)}c(void 0)}))}}i.d(e,"a",(function(){return o}));var s=i("+Aae").a,o={onLoadComplete:function(t){o.loadCb=t},beginLoad:function(){return r(regeneratorRuntime.mark((function t(){var e,i,n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.idb.get("dataSet");case 2:if(e=t.sent){t.next=15;break}return t.next=6,fetch("/data_source.json");case 6:return i=t.sent,t.next=9,i.json();case 9:return e=t.sent,console.log("loaded from file"),t.next=13,s.idb.set("dataSet",e);case 13:t.next=16;break;case 15:console.log("loaded from db");case 16:return t.next=18,s.idb.get("Icons");case 18:return(n=t.sent)&&(e.icons=n),t.next=22,s.idb.get("SaveGame");case 22:if(t.t0=t.sent,t.t0){t.next=25;break}t.t0={};case 25:r=t.t0,o.init(e,r);case 27:case"end":return t.stop()}}),t)})))()},init:function(t,e){return r(regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:s.icon.import(t.icons),s.item.import(s.icon.restoreIcons(t.item)),s.res.import(s.icon.restoreIcons(t.resource)),s.rec.import(s.icon.restoreIcons(t.recipe),s.item),s.tech.import(s.icon.restoreIcons(t.technology),s,null==e?void 0:e.techs),s.entity.import(s.icon.restoreIcons(t.entity),s),o.loadCb({mgrs:s,save:e});case 7:case"end":return i.stop()}}),i)})))()},saveGame:function(t){t?s.idb.set("SaveGame",t):(s.idb.del("SaveGame"),window.location.reload())}}}}]);
//# sourceMappingURL=app~f075b844.d3bb773be2e91c21c3b9.bundle.map