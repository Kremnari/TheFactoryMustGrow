(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{0:function(t,i,e){e("GAND"),e("GmYv"),t.exports=e("b9nV")},"463H":function(t,i,e){"use strict";e.d(i,"b",(function(){return n})),e.d(i,"a",(function(){return r}));var n=30,r=60*n*5},BEPO:function(t){t.exports=JSON.parse('{"a":false,"b":false}')},EfK0:function(t,i,e){"use strict";e.d(i,"c",(function(){return s})),e.d(i,"b",(function(){return c})),e.d(i,"a",(function(){return u}));e("aurelia-event-aggregator");function n(t,i){var e;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(e=function(t,i){if(!t)return;if("string"==typeof t)return r(t,i);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return r(t,i)}(t))||i&&t&&"number"==typeof t.length){e&&(t=e);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(e=t[Symbol.iterator]()).next.bind(e)}function r(t,i){(null==i||i>t.length)&&(i=t.length);for(var e=0,n=new Array(i);e<i;e++)n[e]=t[e];return n}var s=function(){function t(){this.itemList={}}var i=t.prototype;return i.import=function(t){var i=this;Object.entries(t).forEach((function(t){var e=t[0],n=t[1],r=new o(n);i.itemList[e]=r}))},i.get=function(t){return this.itemList[t]},i.incrementX=function(t){return++this.itemList[t].count},i.addNotifyX=function(t,i){var e;null==(e=this.itemList[t])||e.notifys.push(i)},t}(),o=function(){function t(t,i){this.isVisible=!1,this.isCraftable=!1,this.entity=!1,this.notifys=[],this.set_count_callbacks=["ItemNotifys"],Object.assign(this,t)}return t.prototype.ItemNotifysX=function(){var t=this;this.notifys.forEach((function(i){i.ingCheck(t.name,t.__count)}))},t}(),c=function(){function t(t,i){"string"==typeof t&&(this.name=t),"Object"==typeof t&&(this.name=t.name,this.item=t),this.count=i}return t.convert=function(i){return i.count?i:new t(i.name||i.item,i.amount)},t}(),u=function(){function t(t,i){void 0===i&&(i=0),this.items=Array.isArray(i)?i:new Array(i),this.itemMgr=t.item,this.recMgr=t.rec,this.signaler=t.signaler}var i=t.prototype;return i.serialize=function(){return this.items},i.deserialize=function(t){this.items=t},i[Symbol.iterator]=function(){return this.items},i.addAll=function(t,i,e){void 0===i&&(i=!0),void 0===e&&(e=1);for(var r,s=[],o=0,u=n(t);!(r=u()).done;){var a=r.value;(o=this.add(a.item||a.name,(a.amount||a.count)*e))>0&&s.push(new c(a.name||a.item,o))}if(i)return s},i.consumeAll=function(t,i,e){void 0===i&&(i=!0),void 0===e&&(e=1);for(var r,s=[],o=0,u=n(t);!(r=u()).done;){var a=r.value,f=c.convert(a);if(0==(o=this.consume(f.item||f.name,(f.count||f.amount)*e)))s.push(f);else if(i)return s.length>=1?this.addAll(s,!1,e):this.add(f.item,f.count-o),s=null,t}return[]},i.total=function(t){return this.items.reduce((function(i,e){return e&&e.name==t?i+e.count:i}),0)},i.add=function(t,i){if(0!=i){var e=this.itemMgr.get(t).stack_size,n=this._GetAddStack(t,e);if(!n)return i;var r=Math.min(e-n.count,i);return n.count+=r,i-r>0?this.add(t,i-r):0}},i.consume=function(t,i){var e=this._GetSubStack(t,!0),n=this.items[e];if(!n)return i;if(n.count-=i,n.count<0){var r=-1*n.count;return n.count=0,this.items[e]=void 0,this.consume(t,r)}return 0==n.count&&(this.items[e]=void 0),0},i._GetAddStack=function(t,i){for(var e=-1,n=0,r=[function(e){return e&&e.name==t&&e.count<i},function(t){return t&&0==t.count},function(t){return!t}];n<r.length;n++){var s=r[n];if((e=this.items.findIndex(s))>-1)break}return e>-1&&(!this.items[e]||this.items[e].name!=t)&&this.items.splice(e,1,{name:t,count:0}),this.items[e]},i._GetSubStack=function(t,i){void 0===i&&(i=!0);var e=this.items.length-1-this.items.slice().reverse().findIndex((function(i){return i&&i.name==t}));return i?e:this.items[e]},i.click=function(t){switch(t.what){case"use":var i=t.which.item||this.itemMgr.get(t.which.name);if(t.which.count>0&&i.hasEntity)return t.which.count--,t.where.entityStore.AddEntity(t.which.name,this),void this.signaler.signal("addedEntity");break;case"move":var e=t.rounder.val,n=t.where.inv.consume(t.which.name,e),r=t.who.inv.add(t.which.name,e-n);t.where.inv.add(t.which.name,r)}},t}()},fcJs:function(t,i,e){"use strict";e.d(i,"a",(function(){return f})),e.d(i,"b",(function(){return v}));var n=e("By/q"),r=e("zYKg"),s=e("EfK0");function o(t,i){var e;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(e=function(t,i){if(!t)return;if("string"==typeof t)return c(t,i);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return c(t,i)}(t))||i&&t&&"number"==typeof t.length){e&&(t=e);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(e=t[Symbol.iterator]()).next.bind(e)}function c(t,i){(null==i||i>t.length)&&(i=t.length);for(var e=0,n=new Array(i);e<i;e++)n[e]=t[e];return n}function u(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(t,i){t.prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i}var f=function(){function t(){this.entities_base={},this.entity_cats=[]}var i=t.prototype;return i.import=function(t,i){var e=this;this.itemMgr=i.item,this.techMgr=i.tech,Object.entries(t).forEach((function(t){var i=t[0],n=t[1];e.itemMgr.itemList[i]?(e.itemMgr.itemList[i].hasEntity=!0,e.entities_base[i]=n,n.crafting_categories&&n.crafting_categories.forEach((function(t){e.entity_cats[t]||(e.entity_cats[t]=[]),e.entity_cats[t].push(n.name)}))):console.warn("cannot locate  item for entity: "+i)})),Object.defineProperty(this,"avail_cats",{get:function(){var t=this,i=[];return Object.entries(this.entity_cats).forEach((function(e){var n=e[0];e[1].some((function(i){return t.itemMgr.itemList[i].count>0}))&&i.push(n)})),i}}),i.Ticker.DataProvider((function(t){e.TickerProvider(t)}))},i.TickerProvider=function(t){t.entities||(t.entities={}),t.entities.types||(t.entities.types=[]),t.entities.types.push("crafting"),t.entities.types.push("mining")},i.GenerateEntity=function(t,i,e){var n=this.entities_base[t];return n.resource_categories?new m(n,i,e):n.crafting_categories?new l(n,i,e):!!n.inputs&&new g(n,i,e)},i.RestoreEntity=function(t,i,e,n){var r=this.entities_base[t.name],s=null;return"mining"==t.type?(s=new m(r,i,e),""!=t.mining&&s.set_mining(n.res.resList[t.mining],t.mining_timer)):"crafting"==t.type?(s=new l(r,i,e),""!=t.recipe&&s.set_recipe(n.rec.recipeList[t.recipe],t.crafting_timer)):"lab"==t.type&&((s=new g(r,i,e)).research_timer=t.research_timer),s.restoreBuffers(t.buffers),s},i.set_player=function(t){this.player=t},i.upgrade=function(t){"buffers"==t.type?0==this.player.inv.consumeAll([new s.b("iron-chest",2)],!0).length?t.who.buffers[t.dir].max+=10:console.log("not enough...awesome"):"autoload"==t.type&&(0==this.player.inv.consumeAll([new s.b("burner-inserter",1)],!0).length?t.who.buffers[t.dir].xfer.count++:console.log("not enough...awesome"))},t}(),h=function(){function t(t,i,e,r){void 0===r&&(r=null),this.buffers={out:{max:5,qty:0,xfer:{timer:0,ticks:30,count:0}},in:{max:5,qty:0,xfer:{timer:0,ticks:30,count:0}}},Object.assign(this,t),this.inv=i,this.tags=Object(n.a)({to:e,entity:this}),r&&this.tags.push("type",r)}var i=t.prototype;return i.deserialize=function(t){throw new Error("Abstract method, please override")},i.serialize=function(){throw new Error("Abstract method, please override")},i.tick=function(t){console.warn("base entity ticked")},i.incrementBuffer=function(){return this.buffers.out.qty++,this.buffers.out.qty==this.buffers.out.max},i.restoreBuffers=function(t){this.buffers=t},t}(),m=function(t){function i(i,e,n){var r;return(r=t.call(this,i,e,n,"mining")||this).mining=null,r.buffers.in=void 0,r}a(i,t);var e=i.prototype;return e.deserialize=function(t){Object.assign(this,t)},e.serialize=function(){var t,i={};return i.name=this.name,i.type="mining",i.mining=(null==(t=this.mining)?void 0:t.name)||"",i.buffers=this.buffers,i.mining_timer=this.mining_timer,i},e.tick=function(t){var i=this.buffers.out.xfer;i.count>0&&++i.timer==i.ticks&&(this.collectBuffer(this,i.count),i.timer=0),this.mining&&this.buffers.out.qty!=this.buffers.out.max&&++this.mining_timer%16==0&&(this.buffers.out.qty++,this.mining_timer=0)},e.set_mining=function(t,i){var e=this;this.collectBuffer(),t!=this.mining?(this.mining=null,window.setTimeout((function(){e.mining=t,e.mining_time=t.mining_time/e.mining_speed*100,e.mining_timer=i||0}),0),this.tags.push("ticking","mining")):(this.mining=null,this.tags.delete("ticking"))},e.collectBuffer=function(t,i){void 0===t&&(t=this),void 0===i&&(i=this.buffers.out.qty),0!=this.buffers.out.qty&&(this.buffers.out.qty-=i-t.inv.add(this.mining.mining_results,i))},i}(h),l=function(t){function i(i,e,n){var r;return(r=t.call(this,i,e,n,"crafting")||this).recipe=null,r}a(i,t);var e,n,r,s=i.prototype;return s.tick=function(t){var i=this.buffers.in.xfer;i.count>0&&++i.timer==i.ticks&&(this.consumeIngs(),i.timer=0),(i=this.buffers.out.xfer).count>0&&++i.timer==i.ticks&&(this.collectBuffer(this,i.count),i.timer=0),this.recipe&&this.buffers.in.qty>0&&this.buffers.out.qty<this.buffers.out.max&&(this.crafting_timer++,this.crafting_timer%16==0&&(this.buffers.in.qty--,this.buffers.out.qty++,this.crafting_timer=0))},s.deserialize=function(t){Object.assign(this,t)},s.serialize=function(){var t,i={};return i.name=this.name,i.type="crafting",i.buffers=this.buffers,i.crafting_timer=this.crafting_timer,i.recipe=(null==(t=this.recipe)?void 0:t.name)||"",i},s.clear_recipe=function(){var t=this;if(this.buffers.in.qty>0)for(var i=1;i<=this.buffers.in.qty;i++)this.recipe.ingredients.forEach((function(i){t.inv.add(i.name,i.amount)}));this.collectBuffer(),this.tags.delete("ticking"),this.recipe=null},s.set_recipe=function(t,i){this.recipe&&this.clear_recipe(),this.recipe=t,this.crafting_time=t.crafting_speed/this.crafting_speed*100,this.crafting_timer=i||0,this.tags.push("ticking","crafting")},s.consumeIngs=function(t){if(this.recipe&&this.buffers.in.qty!=this.buffers.in.max){var i=this.inv.recMgr.canProduceMax(this.recipe,this.inv);if(0!=i){var e=(null==t?void 0:t.calc(this.buffers.in.qty,this.buffers.in.max,i))||1;this.inv.consumeAll(this.recipe.ingredients,!0,e),this.buffers.in.qty+=e}}},s.collectBuffer=function(t,i){void 0===t&&(t=this),void 0===i&&(i=this.buffers.out.qty);t.inv.addAll(this.recipe.results,!0,i);this.buffers.out.qty=0},e=i,(n=[{key:"canConsumeIngs",get:function(){return!0}}])&&u(e.prototype,n),r&&u(e,r),i}(h),g=function(t){function i(i,e,n){var r;return(r=t.call(this,i,e,n,"lab")||this).buffers.in={max:10,xfer:{timer:0,ticks:30,count:0}},r.buffers.out=void 0,r.inputs.forEach((function(t){return r.buffers.in[t]={qty:0}})),r.research_timer=NaN,r}a(i,t);var e=i.prototype;return e.deserialize=function(t){Object.assign(this,t)},e.serialize=function(){var t={};return t.name=this.name,t.type="lab",t.buffers=this.buffers,t.research_timer=this.research_timer,t},e.canAdd=function(t){return 0!=this.inv.total(t)&&this.buffers.in[t].qty!=this.buffers.in.max},e.addPotion=function(t,i){if(this.canAdd(t)){var e=i.calc(this.buffers.in[t].qty,this.buffers.in.max,this.inv.total(t));e-=this.inv.consume(t,e),this.buffers.in[t].qty+=e,this.tags.push("ticking","lab")}},e.tick=function(t){var i=this.buffers.in.xfer;if(i.count>0&&++i.timer==i.ticks){for(var e,n=NaN,r=o(this.inputs);!(e=r()).done;){var s=e.value;(n=this.buffers.in.max-this.buffers.in[s].qty)>0&&this.inv.consume(s,Math.min(i.count,n))}i.timer=0}t.mgrs.tech.researching&&(Number.isNaN(this.research_timer)&&this.nextUnit(t.mgrs.tech.nextIngredients),this.research_timer++,this.research_timer%16==0&&(t.mgrs.tech.increment_research(),this.research_timer=NaN))},e.nextUnit=function(t){var i=this;t.every((function(t){var e=t[0],n=t[1];return i.buffers.in[e].qty>=n}))?(t.forEach((function(t){var e=t[0],n=t[1];return i.buffers.in[e].qty-=n})),this.research_timer=0,this.tags.push("ticking","lab")):this.tags.delete("ticking")},i}(h),v=function(){function t(t,i,e){var n=this;this.entities=[],this.entityTags=new r.a,this.mgr=t,this.parent=i,e.subscribe((function(t){n.tick(t)}))}var i=t.prototype;return i.deserialize=function(t,i){for(var e,n=null,r=o(t);!(e=r()).done;){var s=e.value;(n=this.mgr.RestoreEntity(s,this.parent.inv,this.entityTags,i)).parent=this.parent,this.entities.push(n)}},i.serialize=function(){var t=[];for(var i in this.entities)t[i]=this.entities[i].serialize();return t},i.AddEntity=function(t){var i=this.mgr.GenerateEntity(t,this.parent.inv,this.entityTags);i.parent=this.parent,this.entities.push(i)},i.tick=function(t,i){for(var e,n=o(t.entities.types);!(e=n()).done;){var r=e.value;this.entityTags.getSetValues("ticking",r).forEach((function(e){e.tick(t,i)}))}},t}()},mUjK:function(t,i,e){"use strict";e.d(i,"a",(function(){return n}));var n=function(){function t(){this.iconList={}}var i=t.prototype;return i.import=function(t){this.iconList=t;for(var i=0,e=Object.entries(this.iconList.tool);i<e.length;i++){var n=e[i],r=n[0],s=n[1];this.iconList.item[r]=s}},i.getSrc=function(t,i){var e;if(!t)return"";if(t.indexOf("@")>-1&&!i){var n=t.split("@");t=n[0],i=n[1]}return null==(e=this.iconList[t])||e[i],this.iconList[t][i]},i.restoreIcons=function(t){var i=this;return Object.values(t).forEach((function(t){var e;if(t.icon){var n=t.icon.split("@"),r=n[0],s=n[1];t.icon=(null==(e=i.iconList[r])?void 0:e[s])||i.iconList.item[s]}})),t},t}()},uShe:function(t,i,e){"use strict";e.d(i,"a",(function(){return v}));var n,r=e("aurelia-framework"),s=e("mUjK"),o=e("EfK0"),c=e("O9YP"),u=e("MJ0g"),a=e("59E+"),f=e("rOV7"),h=e("fcJs"),m=e("ztCj");function l(t,i,e,n,r,s,o){try{var c=t[s](o),u=c.value}catch(t){return void e(t)}c.done?i(u):Promise.resolve(u).then(n,r)}function g(t){return function(){var i=this,e=arguments;return new Promise((function(n,r){var s=t.apply(i,e);function o(t){l(s,n,r,o,c,"next",t)}function c(t){l(s,n,r,o,c,"throw",t)}o(void 0)}))}}var v=Object(r.c)(s.a,o.c,c.a,a.a,u.a,h.a)(n=function(){function t(t,i,e,n,r,s){this.mgrs={icon:t,item:i,res:e,tech:n,rec:r,entity:s,idb:{set:m.c,get:m.b,del:m.a}},this.mgrs.Ticker=new f.a}var i=t.prototype;return i.onLoadComplete=function(t){this.loadCb=t},i.beginLoad=function(){var t=g(regeneratorRuntime.mark((function t(){var i,e,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(m.b)("dataSet");case 2:if(i=t.sent){t.next=15;break}return t.next=6,fetch("./data_source.json");case 6:return e=t.sent,t.next=9,e.json();case 9:return i=t.sent,console.log("loaded from file"),t.next=13,Object(m.c)("dataSet",i);case 13:t.next=16;break;case 15:console.log("loaded from db");case 16:return t.next=18,Object(m.b)("SaveGame");case 18:if(t.t0=t.sent,t.t0){t.next=21;break}t.t0={};case 21:n=t.t0,this.init(i,n);case 23:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),i.init=function(){var t=g(regeneratorRuntime.mark((function t(i,e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.mgrs.icon.import(i.icons),this.mgrs.item.import(this.mgrs.icon.restoreIcons(i.item)),this.mgrs.res.import(this.mgrs.icon.restoreIcons(i.resource)),this.mgrs.rec.import(this.mgrs.icon.restoreIcons(i.recipe),this.mgrs.item),this.mgrs.tech.import(this.mgrs.icon.restoreIcons(i.technology),this.mgrs,null==e?void 0:e.techs),this.mgrs.entity.import(this.mgrs.icon.restoreIcons(i.entity),this.mgrs),this.loadCb({mgrs:this.mgrs,save:e});case 7:case"end":return t.stop()}}),t,this)})));return function(i,e){return t.apply(this,arguments)}}(),i.saveGame=function(t){t?Object(m.c)("SaveGame",t):(Object(m.a)("SaveGame"),window.location.reload())},t}())||n}}]);
//# sourceMappingURL=app~f075b844.c879507d806abd8e66e2.bundle.map