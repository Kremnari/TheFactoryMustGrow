(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{app:function(e,t,n){"use strict";n.r(t),n.d(t,"App",(function(){return f}));var i,a=n("aurelia-templating-resources"),r=n("aurelia-framework"),s=n("uShe"),o=n("463H"),c=n("0d46"),u=n("6juG"),h=n("7jDb"),l=n("XkjI"),m=n("iVgR"),v=n("Evr9");function g(e,t,n,i,a,r,s){try{var o=e[r](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(i,a)}function d(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var r=e.apply(t,n);function s(e){g(r,i,a,s,o,"next",e)}function o(e){g(r,i,a,s,o,"throw",e)}s(void 0)}))}}function w(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var f=Object(r.d)(a.a,r.b)(i=function(){function e(e,t){var n=this;this.showTut=!0,this.dataBase={},this.viewRecCat=!1,window.tfmg=this,this.Math=Math,this.signaler=e,this.IgorJs=h.a,u.a.signaler=this.signaler,u.a.app=this,this.view=u.c,this.view.set({type:"view",which:"main",what:"home"}),this.view.set({type:"context",what:"standard"}),this.CCC=c.a,this.Tutorial=v.a,this.save=function(){h.a.saveGame(),n.autoSave(),n.autoSave()},t.expressionObserver(this,"view.ctrl.main").subscribe((function(e,t){n.whenCheck(e,t,"main")})),this.Igor_init()}var t,n,i,a=e.prototype;return a.Igor_init=function(){var e=d(regeneratorRuntime.mark((function e(){var t,n,i,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=location.href.slice(0,location.href.lastIndexOf("/")),e.next=3,fetch(t+"/tfmg_base_config.json5");case 3:return n=e.sent,e.t0=l,e.next=7,n.text();case 7:return e.t1=e.sent,i=e.t0.parse.call(e.t0,e.t1),e.next=11,h.a.initialize({commandTasker:c.b,viewTasker:u.b,ticker:{ticks_per_sec:o.e,ticks_max_phase:o.d},dbName:"TheFactoryMustGrow",dataSet:i});case 11:s.a.onLoadComplete((function(e){a.init(e)})),s.a.beginLoad(i,h.a.getDataSets());case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),a.init=function(){var e=d(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.mgrs=t.mgrs,this.mgrs.baseApp=this,c.b.initialize({dataSet:t.mgrs.data,viewer:u.c}),Object(m.a)(h.a),e.next=6,h.a.loadDatabase(t.mgrs.data);case 6:return this.dataSet=h.a.dataSet,this.globals=h.a.globalObject,c.b.setRunner(h.a.getRunner()),this.IgorRunner=h.a.getRunner(),this.globals=h.a.getNamed("global"),c.a.staticProvide("player","inventory",this.globals.player.inv),c.a.staticProvide("service","rounder",this.mgrs.rounder),u.a.setClassFn("canCraft",(function(e){return e.ingredients.every((function(e){return n.IgorRunner.processTEMP(n.globals.player.inv.items,"inventory.total",{name:e.name})>=e.amount}))?"recipeEnabled":"recipeDisabled"})),u.a.setViewFn("recipeFilter",(function(e){return Object.values(n.IgorRunner.data.recipe).filter((function(t){return(void 0===t.enabled||t.enabled||n.globals.unlocked_recipes.includes(t.name))&&(Array.isArray(e)&&e.includes(t.category)||t.category==e)}))})),u.a.setViewFn("objectValues",(function(e){return Object.values(e)})),u.a.setViewFn("technologyFilter",(function(){return tfmg.showAllTechs?Object.values(tfmg.dataSet.technology):Object.values(tfmg.dataSet.technology).filter((function(e){var t;return(null==(t=n.globals.research[e.name])?void 0:t.complete)?tfmg.view.options.bDoneTechs:!e.prerequisites||e.prerequisites.every((function(e){var t;return null==(t=n.globals.research[e])?void 0:t.complete}))})).sort((function(e,t){return e.name>t.name?1:-1}))})),u.a.setViewFn("workshopEntities",(function(){var e=n.IgorJs.arrayFromIds(n.globals.player.workshop.entities);return e=e.sort((function(e,t){return e.order>t.order?-1:1}))})),u.a.setViewFn("playerInventory",(function(){var e=n.globals.player.inv.items;return e=e.sort((function(e,t){return e.name==t.name?e.count>t.count?-1:1:e.name>t.name?1:-1}))})),e.next=21,this.mgrs.idb.get("dev");case 21:this.showDev=e.sent,this.showDev||(h.a.setState("start"),this.globals.activeFeatures.tutorial?v.a.start(this):this.autoSave()),u.a.setViewFn("sort",(function(e){return e=e.sort((function(e,t){return e.order>t.order?1:-1}))}));case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),a.autoSave=function(){var e=this;this.autoSave.sub?(this.IgorJs.Ticker.dispose(this.autoSave.sub),this.autoSave.secs=function(){return 0},this.autoSave.sub=null):(this.autoSave.sub=h.a.Ticker.subscribe((function(){h.a.saveGame()}),o.d/5),this.autoSave.secs=function(){return Math.floor((o.d/5-h.a.Ticker.ticks%(o.d/5)+e.autoSave.sub.phase)/o.e)})},a.when=function(e,t){this.whenTarg={targ:e,cb:t},console.log("whenSet")},a.whenCheck=function(e,t,n){this.whenTarg&&(this.whenTarg.targ.entityPane&&this.view.ctrl.entityPane!=this.whenTarg.targ.entityPane||this.whenTarg.targ.main&&this.view.ctrl.main!=this.whenTarg.targ.main||(this.whenTarg.cb(),this.whenTarg=void 0))},a.test=function(e){console.log(e)},a.isAwesome=function(){this.showAllTechs=!0,this.editDataSource=!0},a.nukeCache=function(){this.mgrs.idb.clear(),window.location.reload()},a.hideTutorial=function(){v.a.clearTut()},a.jumpTutorial=function(){this.IgorRunner.checkAndEmit("system_update","facBlock",{}),this.globals.activeFeatures.tutorial={step:49},v.a.jump(this)},a.copySave=function(){var e=d(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.IgorJs.commands("copySave");case 2:navigator.clipboard.writeText(window.tfmg_save),this.view.goodToast("Copied save to clipboard");case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),a.resetDS=function(){this.mgrs.idb.del("last_ds"),location.reload()},a.toggleDev=function(e){this.mgrs.idb.set("dev",!this.showDev),this.showDev=!this.showDev},a.resetSave=function(){h.a.commands("resetSave")&&location.reload()},a.jumpStart=function(){this.IgorRunner.processTEMP("player.inventory","inventory.add",{itemStacks:[{name:"lab",count:10},{name:"automation-science-pack",count:200},{name:"inserter",count:50},{name:"iron-chest",count:50},{name:"stone",count:100},{name:"burner-mining-drill",count:10},{name:"stone-furnace",count:10},{name:"assembling-machine-1",count:10},{name:"transport-belt",count:100},{name:"logistic-science-pack",count:100},{name:"radar",count:100},{name:"offenseBot",count:100}]}),this.showAllTechs=!0,this.globals.land.total+=400,this.globals.control.bonusTicks=6e4,this.signaler.signal("generalUpdate")},t=e,(n=[{key:"showTechX",set:function(e){var t=this;console.error("SHOWEDTECH"),this.viewPane.showingTech=null,e&&window.setTimeout((function(){t.viewPane.showingTech=e}))}//! NUKE in favor of chameView
},{key:"showItemX",set:function(e){var t=this;if(console.error("SHOWEDITEM"),e.item)if("string"==typeof e.item&&e.item.includes("id")&&(e.item=this.IgorJs.getObjId(e.item)),this.viewPane.showingItem==e.item&&e.double)this.viewPane.main=e.double.view;else{var n=this.viewPane.showingItem;this.viewPane.showingItem=null,this.viewPane.showingCat="",this.viewPane.connectedItems=null,e&&n!=e.item&&window.setTimeout((function(){t.viewPane.showingItem=e.item,t.viewPane.showingCat=e.cat,e.view&&(t.viewPane.main=e.view),e.setConnected&&(t.setConnectedItems=e)}),0)}}},{key:"setConnectedItems",set:function(e){var t,n,i={};null==(t=e.item.connections.drains)||t.forEach((function(e){i[e.parent||e]="drain"})),null==(n=e.item.connections.sources)||n.forEach((function(e){i[e.parent||e]+=" source"})),this.view.set({type:"scope",which:"connectedItems",what:i})}}])&&w(t.prototype,n),i&&w(t,i),e}())||i}}]);
//# sourceMappingURL=app~6154e0aa.3f8e56b149e25b048d64.bundle.map