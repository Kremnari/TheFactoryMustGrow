(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{"+Aae":function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n("mUjK"),r=n("EfK0"),s=n("MJ0g"),o=n("++kE"),u=n("fcJs"),a=n("ztCj"),c={icon:new i.a,item:new r.c,rec:new s.a,entity:new u.a,rounder:o.a,DS:null,idb:{set:a.f,get:a.d,del:a.c,clear:a.b,list:a.e}}},"/tIO":function(e,t,n){"use strict";n.d(t,"a",(function(){return h})),n.d(t,"b",(function(){return b}));var i=n("fcJs"),r=n("EfK0"),s=n("+Aae"),o=n("wb4v");function u(e,t,n,i,r,s,o){try{var u=e[s](o),a=u.value}catch(e){return void n(e)}u.done?t(a):Promise.resolve(a).then(i,r)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var s=e.apply(t,n);function o(e){u(s,i,r,o,a,"next",e)}function a(e){u(s,i,r,o,a,"throw",e)}o(void 0)}))}}function c(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return f(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function l(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var p=0;function d(e){return"__private_"+p+++"_"+e}var h=function(){function e(t,n){var o,u=this;switch(this.entityTypes=!1,this.upgrades={},t){case"resource":o={output:!0,line:!0},this.entityTypes="mining";break;case"bus":o={input:!0,output:!0,delay:!0},this.tick=this.tick_bus;break;case"research":o={input:!0,line:!0},this.entityTypes="research";break;case"factory":default:this.entityTypes="crafting",o={input:!0,output:!0,line:!0}}this.lines=[],this.feeds=[],this.drains=[],this.name=n,this.type=t,this.upgrades={base:this},e.assign(this.name+":"+this.type,this),o.input&&(this.upgrades.input={buffers:{count:0,type:"buffers",max:3},loaders:{count:0,type:"loaders",max:10}},this.inputLine=new r.a(5,5)),o.output&&(this.upgrades.output={buffers:{count:0,type:"buffers",max:3},loaders:{count:0,type:"loaders",max:10}},this.outputLine=new r.a(5,5)),o.line&&this.lines.push(new i.b(this,{type:this.entityTypes,feed:this.inputLine,drain:this.outputLine})),s.a.Ticker.subscribe((function(e){return u.tick(e)}))}e.new=function(t,n){return"factory"!=t?new e(t,n):{name:n,type:t,size:100,complexity:1,inputLine:{items:[],connection:null},outputLine:{items:[],connection:null},processingLines:[{recipe:null,building:null,prepped:null,counts:{buildings:0,prepped:0,producing:0},timers:{production:0}}]}},e.assign=function(e,t){l(this,m)[m][e]&&l(this,m)[m][e].forEach((function(e){e(t)})),l(this,y)[y][e]=t},e.acquire=function(e,t){l(this,y)[y][e]?t(l(this,y)[y][e]):(l(this,m)[m][e]||(l(this,m)[m][e]=[]),l(this,m)[m][e].push(t))},e.deserialize=function(t){var n=this,s=new e(t.type,t.name);return s.upgrades=t.upgrades,s.base=s,t.inputLine&&(s.inputLine=r.a.deserialize(t.inputLine)),t.outputLine&&(s.outputLine=r.a.deserialize(t.outputLine)),t.lines&&(s.lines=[],t.lines.forEach((function(e,t){s.lines[t]=i.b.deserialize(n,e)}))),t.feeds&&(s.feeds=[],t.feeds.forEach((function(t,n){return e.acquire(t,(function(e){s.feeds[n]=e}))}))),t.drains&&(s.drains=[],t.drains.forEach((function(t,n){return e.acquire(t,(function(e){s.drains[n]=e}))}))),s};var t=e.prototype;return t.serialize=function(){var e={};return e.name=this.name,e.type=this.type,e.entityTypes=this.entityTypes,this.inputLine&&(e.inputLine=this.inputLine.serialize()),this.outputLine&&(e.outputLine=this.outputLine.serialize()),this.feeds&&(e.feeds=this.feeds.map((function(e){return e.name+":"+e.type}))),this.drains&&(e.drains=this.drains.map((function(e){return e.name+":"+e.type}))),this.lines&&(e.lines=this.lines.map((function(e){return e.serialize()}))),e.upgrades=this.upgrades,e.upgrades.base=void 0,e},t.tick_bus=function(e){if(e.ticks%40==0)for(var t,n=c(this.drains);!(t=n()).done;){var i=t.value;if("bus"==i.type)return;0!=this.upgrades.output.count&&Object(o.a)(this.outputLine,i.inputLine,{maxXfer:this.upgrades.output.loaders.count})}},t.tick=function(e){this.inputLine&&e.ticks%30==0&&this.upgrades.input.loaders.count&&Object(o.a)(this.inputLine,this.lines[0],{maxXfer:2*this.upgrades.input.loaders.count,toAs:"entity"}),e.fromParent={feed:this.inputLine,drain:this.outputLine};for(var t,n=c(this.lines);!(t=n()).done;){var i=t.value;i.tick(e),i.tick_restricted(e)}this.drains[0]&&e.ticks%30==0&&this.upgrades.output.loaders.count&&Object(o.a)(this.outputLine,this.drains[0].inputLine,{maxXfer:2*this.upgrades.output.loaders.count})},t.useItem=function(e){if("bus"!=this.type)return this.lines[0].AddEntity(e)},t.add_EntityLine=function(){this.lines.splice(-1,0,new r.a(5),new i.b(this,this.entityTypes))},t.SelectBusFeed=function(){var e=a(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.a.DS.open("SelectBus",{base:s.a.baseApp});case 2:if(null==(t=e.sent)?void 0:t.selected){e.next=5;break}return e.abrupt("return");case 5:this.AddBusFeed(t.selected);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.AddBusFeed=function(e){this.inputLine&&e&&!this.feeds.includes(e)&&(this.feeds.push(e),e.AddBusDrain(this))},t.DelBusFeed=function(e){this.feeds=this.feeds.filter((function(t){return t!=e}))},t.SelectBusDrain=function(){var e=a(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.a.DS.open("SelectBus",{base:s.a.baseApp});case 2:if(null==(t=e.sent)?void 0:t.selected){e.next=5;break}return e.abrupt("return");case 5:this.AddBusDrain(t.selected);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.AddBusDrain=function(e){e&&!this.drains.includes(e)&&(this.drains.push(e),e.AddBusFeed(this))},t.DelBusDrain=function(e){this.drains=this.drains.filter((function(t){return t!=e}))},t.ApplyUpgrade=function(e){"buffers"!=e.upgrade.type?"loaders"!=e.upgrade.type||0==e.inv.consume("inserter",1)&&e.upgrade.count++:0==e.inv.consume("iron-chest",1)&&(e.upgrade.count++,e.line.max_stack*=2)},e}(),y=d("blocks"),m=d("awaiting");Object.defineProperty(h,y,{writable:!0,value:{}}),Object.defineProperty(h,m,{writable:!0,value:{}});var b=function(){function e(e){var t=this;this.inv=new r.a(e),this.entityStore=new i.b(this),s.a.Ticker.subscribe((function(e){t.tick(e)}))}e.deserialize=function(t){var n=new e;return n.inv.deserialize(t.inv),n.entityStore.deserialize(t.entityStore),n};var t=e.prototype;return t.serialize=function(){var e={};return e.inv=this.inv.serialize(),e.entityStore=this.entityStore.serialize(),e},t.getEntities=function(e){var t,n;return e?Array.from((null==(t=this.entityStore.entityTags.get("type"))||null==(n=t.get(e))?void 0:n.values())||[]):Array.from(this.entityStore.entities)},t.useItem=function(e){return this.entityStore.AddEntity(e)},t.tick=function(e){e.fromParent={feed:this.inv,drain:this.inv},this.entityStore.tick(e)},e}()},"8p7n":function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var i=n("/tIO"),r=n("0d46"),s=n("6juG"),o=(n("7jDb"),{player:i.b,DefenseBlock:function(){var e={machines:{},ammo:0,repair:0};return e},DefenseBus:function(){return{}},OffenseBlock:function(){var e={machines:{},supply:0,fuel:0};return e},OffenseBus:function(){return{}}});s.a.AddGameObjectClass("turret",{name:"turret",count:0},{category:"defenseMachines"}),s.a.AddGameObjectClass("radar",{name:"radar",count:0},{category:"offenseMachines"});r.b.provide("factoryBlock.setConnection",(function(e){e.at.factoryXput.connection=e.to_which.factoryBus}),{at:"factoryXput",to_which:"factoryBus",dir:"string"});r.b.provide("factoryBlock.addProdLine",(function(e){e.at.factoryBlock.processingLines.push({recipe:null,building:null,prepped:null,counts:{buildings:0,prepped:0,producing:0},timers:{production:0}})}),{at:"factoryBlock"});r.b.provide("factoryLine.setRecipe",(function(e){e.at.factoryLine.recipe=e.which.recipe}),{at:"factoryLine",which:"recipe"});r.b.provide("factoryLine.setBuilding",(function(e){e.at.factoryLine.building=e.which.building}),{at:"factoryLine",which:"building"});r.b.provide("factoryLine.addBuilding",(function(e){e.at.factoryLine.counts.prepped<=e.at.factoryLine.counts.buildings?s.b.error("Need a prepped spot to build"):!0===e.from.inventory.consumeAll([{name:e.at.factoryLine.building,count:1}])?e.at.factoryLine.counts.buildings++:s.b.error("You must have a "+e.at.factoryLine.building+" to add.")}),{at:"factoryLine",from:"inventory"});r.b.provide("factoryLine.prepLine",(function(e){e.at.factoryLine.counts.prepped++}),{at:["factoryLine","factoryBlock"],from:"inventory"})},FzzP:function(e,t,n){"use strict";function i(){var e={};return e[Symbol.iterator]=function(){return Object.keys(this)},e}n.d(t,"a",(function(){return i}))},JNnP:function(e,t,n){"use strict";var i=n("7jDb"),r=(n("fcJs"),n("6juG")),s=function(e,t){console.log("player entity ticker")};i.a.defineObj("player.entity",(function(e,t,n){return t.buffers={},Object.assign(t,n.data.entity[e.name]),"mining-drill"!=t.subType&&"crafter"!=t.subType||(t.buffers.out={items:[],upgrades:{},stacks:1,stackSize:5,xfer:0,xferTicks:120,xferTimer:NaN}),"crafter"!=t.subType&&"research"!=t.subType||(t.buffers.in={items:[],upgrades:{},stacks:1,stackSize:5,xfer:0,xferTicks:120,xferTimer:NaN}),//!  This won't work when Igor is in a webworker
r.b.signaler.signal("addedEntity"),[t]}),{tick:s}),i.a.addObjectTickFunction("player.entity",s,{});var o=function(e,t,n){n.res?(window.clearTimeout(n.timeout),t.view.animsUpdate(n.res,null,null),n.res=void 0):(n.timeout=window.setTimeout((function(){t.processTEMP(e.player.inventory,"inventory.add",{itemStacks:[{name:e.which.resource.mining_results,count:1}]}),t.view.animsUpdate(n.res,null,null),n.res=void 0}),1e3*e.which.resource.mining_time),n.res=e.which.resource,t.view.animsUpdate(e.which.resource,"isMining",e.which.resource.mining_time))};window.ResourceMine=o;i.a.provide_CCC("resources.mine",o,{which:"resource",player:"inventory"});i.a.provide_CCC("entity.setProcess",(function(e,t){if(!e.at.entity.processing&&null!=e.which.process||(t.processTEMP(e.at.entity,"entity.clearProcess",{returnTo:e.player.inventory}),e.which.process))if(e.at.entity.processing=e.which.process,e.at.entity.$_tags.push("ticking",e.type.class),"mining"==e.type.class)e.at.entity.process_timer=e.which.process.mining_time/e.at.entity.mining_speed*t.config.TICKS_PER_SECOND;else if("crafting"==e.type.class){if(e.at.entity.process_timer=e.which.process.crafting_speed/e.at.entity.crafting_speed*t.config.TICKS_PER_SECOND,e.at.entity.buffers.in){if(e.at.entity.buffers.in.stacks<e.which.process.ingredients.length)return void console.error("cannot fit ingredients");e.which.process.ingredients.forEach((function(t,n){e.at.entity.buffers.in.items[n]={name:t.name,count:0},console.log(t)}))}if(e.at.entity.buffers.out){if(e.at.entity.buffers.out.stacks<e.which.process.results.length)return void console.error("cannot fit results");e.which.process.results.forEach((function(t,n){e.at.entity.buffers.out.items[n]={name:t.name,count:0},console.log(t)}))}}}),{at:"entity",which:"process",type:"class",player:"inventory"}),i.a.addOperation("entity.clearProcess",(function(e,t,n,i){e.buffers.in&&(i.processTEMP(t.returnTo,"inventory.add",{itemStacks:e.buffers.in.items}),//! If args.returnTo is full, 'inventory.add' will fail silently
e.buffers.in.items.length=0),e.buffers.out&&(i.processTEMP(t.returnTo,"inventory.add",{itemStacks:e.buffers.out.items}),//! If args.returnTo is full, 'inventory.add' will fail silently
e.buffers.out.items.length=0),e.processing=null}));i.a.provide_CCC("entity.bufferCollect",(function(e,t){t.processTEMP(e.player.inventory,"inventory.add",{itemStacks:e.which.buffer}),e.which.buffer.count=0}),{which:"buffer",player:"inventory"});i.a.provide_CCC("entity.bufferFill",(function(e,t){e.which.buffer.count+=5}),{which:"buffer",service:"rounder",player:"inventory"})},aSpa:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n("7jDb"),r={inv:{items:[]},workshop:{entities:[]}};i.a.provide_CCC("player.inventoryPush",(function(e,t){e.which.itemStack.count>0&&t.addNewObject(e.to.entities,"player.entity",{name:e.which.itemStack.name})&&e.which.itemStack.count--}),{which:"itemStack",to:"entities"})},main:function(e,t,n){"use strict";n.d(t,"configure",(function(){return r}));n("ls82"),n("SYky");var i=n("BEPO");n("70NS");function r(e){e.use.standardConfiguration().plugin("aurelia-animator-css").plugin("aurelia-dialog").feature("resources/index"),e.use.developmentLogging(i.a?"debug":"warn"),i.b&&e.use.plugin("aurelia-testing"),e.start().then((function(){e.setRoot("app")}))}window.debugIf=function(e,t){e.debug&&e.debug.includes(t)},window.debugCheck=function(e,t){!e.debug&&(e.debug=[]),e.debug.push(t)},Object.walkPath=function(e,t){for(var n=(t=(t=t.replace(/\[(\w+)\]/g,".$1")).replace(/^\./,"")).split("."),i=0,r=n.length;i<r;++i){var s=n[i];isObject(e)&&s in e?e=e[s]:Error("Couldn't walk the path completely")}return e}},wb4v:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));n("+Aae");var i=n("EfK0"),r=n("0d46");function s(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function u(e){var t=e.from,n=e.to,r=e.options;if((null==r?void 0:r.debug)&&(console.log("debug:"),console.log(t),console.log(n),console.log(r)),0!=(null==r?void 0:r.maxXfer)){var o="entity"==(null==r?void 0:r.toAs)?"recieveItem":"addStack",u=0,a=function(e){(null==r?void 0:r.debug)&&console.log(e);var s=n[o](e);return(null==r?void 0:r.debug)&&console.log(s),s&&t.consumeAll(new i.b(e.name,s)),null==r||r.debug,s},c=(null==r?void 0:r.maxXfer)?function(e){return Math.min(e,r.maxXfer-u)}:function(e){return e};if(null==r?void 0:r.stacks)for(var f,l=s(r.stacks);!(f=l()).done;){a(f.value)}else for(var p,d=s(t.items);!(p=d()).done;){var h=p.value;if(h&&h.name&&0!=h.count&&((!(null==r?void 0:r.types)||r.types.includes(h.name))&&(u+=a({name:h.name,count:c(h.count)}),(null==r?void 0:r.debug)&&console.log("accum: "+u),(null==r?void 0:r.maxXfer)&&r.maxXfer==u)))return}}}r.b.provide("invXfer",u),r.b.provide("invUse",(function(e){switch(e.how){case"sub-n-crement":0===e.from.consume(e.what,e.count)&&(e.to_prop?e.to[e.to_prop]+=e.count:e.to+=e.count)}}))}}]);
//# sourceMappingURL=app~b07b7304.26f1ea06b08ef4410a08.bundle.map