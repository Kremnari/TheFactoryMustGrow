(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{FzzP:function(e,t,n){"use strict";function r(){var e={};return e[Symbol.iterator]=function(){return Object.keys(this)},e}n.d(t,"a",(function(){return r}))},iVgR:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r=n("7jDb"),i=n("463H");r.a.provide_CCC("player.inventoryPush",(function(e,t){e.which.itemStack.count>0&&t.data.entity[e.which.itemStack.name]&&t.addNewObject(e.to.entities,"player.entity",{name:e.which.itemStack.name})&&e.which.itemStack.count--}),{which:"itemStack",to:"entities"});var o=n("6juG");r.a.defineObj("player.entity",(function(e,t,n){return t.buffers={},Object.assign(t,n.data.entity[e.name]),"miner"!=t.subType&&"crafter"!=t.subType||(t.buffers.out={items:[],upgrades:{},stacks:1,stackSize:5,xfer:0,xferTicks:120,xferTimer:NaN}),"crafter"!=t.subType&&"research"!=t.subType||(t.buffers.in={items:[],upgrades:{},stacks:1,stackSize:5,xfer:0,xferTicks:120,xferTimer:NaN}),//!  This won't work when Igor is in a webworker
o.b.signaler.signal("addedEntity"),[t]}),{tick:function(e,t,n){e.processing&&!e.buffers.out.items.some((function(t){return t.count>=e.buffers.out.stackSize}))?(e.process_timer&&--e.process_timer,0===e.process_timer&&n.processTEMP(e.buffers.out,"inventory.add",{itemStacks:e.processing.results||{name:e.processing.mining_results,count:1}})&&(e.process_timer=NaN),(Number.isNaN(e.process_timer)||null===e.process_timer)&&("miner"==e.subType||n.processTEMP(e.buffers.in,"inventory.consume",{itemStacks:e.processing.ingredients})?e.process_timer=e.process_ticks:e.$_tags.delete("tick"))):e.$_tags.delete("ticking")}}),r.a.addObjectTickHandler("player.entity",(function(e,t,n){if(0==e.buffers.in.xferTimer--){var r=Math.min(e.buffers.in.xfer,e.buffers.in.stackSize-e.buffers.in.items[0].count);n.processTEMP(n.getNamedObject("player.inventory"),"inventory.consume",{itemStacks:{name:e.buffers.in.items[0].name,count:r}})&&(e.buffers.in.items[0].count+=r,e.$_tags.push("tick","processing")),e.buffers.in.xferTimer=e.buffers.in.xferTicks}}),"inputTicker",{chain:["inputTicker","tick"],num:-5}),r.a.addObjectTickHandler("player.entity",(function(e,t,n){if(0==e.buffers.out.xferTimer--){var r=Math.min(e.buffers.out.xfer,e.buffers.out.stackSize-e.buffers.out.items[0].count);console.log(r),n.processTEMP(n.getNamedObject("player.inventory"),"inventory.add",{itemStacks:{name:e.buffers.out.items[0].name,count:r}})&&(e.buffers.out.items[0].count-=r),e.buffers.out.xferTimer=e.buffers.in.xferTicks}}),"outputTicker",{chain:["tick","outputTicker"],num:5});var s=function(e,t,n){n.res?(window.clearTimeout(n.timeout),t.view.animsUpdate(n.res,null,null),n.res=void 0):(n.timeout=window.setTimeout((function(){t.processTEMP(e.player.inventory,"inventory.add",{itemStacks:[{name:e.which.resource.mining_results,count:1}]}),t.view.animsUpdate(n.res,null,null),n.res=void 0}),1e3*e.which.resource.mining_time),n.res=e.which.resource,t.view.animsUpdate(e.which.resource,"isMining",e.which.resource.mining_time))};window.ResourceMine=s;r.a.provide_CCC("resources.mine",s,{which:"resource",player:"inventory"});r.a.provide_CCC("entity.setProcess",(function(e,t){if(!e.at.entity.processing&&null!=e.which.process||(t.processTEMP(e.at.entity,"entity.clearProcess",{returnTo:e.player.inventory}),e.which.process))if(e.at.entity.processing=e.which.process,e.at.entity.$_tags.push("tick","processing"),"mining"==e.type.class)e.at.entity.process_ticks=e.which.process.mining_time/e.at.entity.mining_speed*t.config.TICKS_PER_SECOND,e.at.entity.process_timer=e.at.entity.process_ticks;else if("crafting"==e.type.class){if(e.at.entity.process_ticks=e.which.process.crafting_speed/e.at.entity.crafting_speed*t.config.TICKS_PER_SECOND,e.at.entity.buffers.in){if(e.at.entity.buffers.in.stacks<e.which.process.ingredients.length)return void console.error("cannot fit ingredients");e.which.process.ingredients.forEach((function(t,n){e.at.entity.buffers.in.items[n]={name:t.name,count:0}}))}if(e.at.entity.buffers.out){if(e.at.entity.buffers.out.stacks<e.which.process.results.length)return void console.error("cannot fit results");e.which.process.results.forEach((function(t,n){e.at.entity.buffers.out.items[n]={name:t.name,count:0}}))}e.at.entity.process_timer=NaN}}),{at:"entity",which:"process",type:"class",player:"inventory"}),r.a.addOperation("entity.clearProcess",(function(e,t,n,r){e.buffers.in&&(r.processTEMP(t.returnTo,"inventory.add",{itemStacks:e.buffers.in.items}),//! If args.returnTo is full, 'inventory.add' will fail silently
e.buffers.in.items.length=0),e.buffers.out&&(r.processTEMP(t.returnTo,"inventory.add",{itemStacks:e.buffers.out.items}),//! If args.returnTo is full, 'inventory.add' will fail silently
e.buffers.out.items.length=0),e.processing=null}));r.a.provide_CCC("entity.bufferCollect",(function(e,t){t.processTEMP(e.player.inventory,"inventory.add",{itemStacks:e.which.buffer}),e.which.buffer.count=0,e.at.entity.$_tags.push("tick","processing")}),{which:"buffer",at:"entity",player:"inventory"});r.a.provide_CCC("entity.bufferFill",(function(e,t){var n=t.processTEMP(e.player.inventory.items,"inventory.total",{name:e.item.buffer.name});if(0!==n){var r=e.service.rounder.calc(e.item.buffer.count,e.which.buffer.stackSize,n);t.processTEMP(e.player.inventory,"inventory.consume",{itemStacks:{name:e.item.buffer.name,count:r}}),e.item.buffer.count+=r,e.at.entity.$_tags.push("tick","processing")}}),{which:"buffer",item:"buffer",at:"entity",service:"rounder",player:"inventory"});var a=[5,10,20,30,40,50];a.MAX=50;function c(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}
//! I don't think these will work under all circumstances,
function f(e,t,n){if(n){for(var r,i=-1,o=4,s=c(e.entries());!(r=s()).done;){var a=r.value,u=a[0],f=a[1];o>3&&!f&&(o=3,i=u),o>2&&f&&0==f.count&&(o=2,i=u),o>1&&f&&f.name==t&&f.count<n&&(o=1,i=u)}return 2==o&&(e[i].name=t,e[i].icon=null),i}var l=e.slice().reverse().findIndex((function(e){return e&&e.name==t&&e.count>0}));return-1==l?-1:e.length-1-l}function l(e,t,n,r){if(t.name){n.count=0;for(var i,o=c(e);!(i=o()).done;){var s=i.value;s.name==t.name&&(n.count+=s.count)}n._result=n.count}else if(t.names)for(var a,u=c(e);!(a=u()).done;){var f=a.value;t.names.indexOf(f.name)>-1&&(n[f.name]?n[f.name]+=f.count:n[f.name]=f.count)}}r.a.provide_CCC("entity.bufferUpgrade",(function(e,t){if("autoload"==e.type.string){if(t.processTEMP(e.player.inventory,"inventory.consume",{itemStacks:{name:"inserter",count:1}})){!e.which.buffer.upgrades.loader&&(e.which.buffer.upgrades.loader={count:0}),e.which.buffer.upgrades.loader.count++,e.which.buffer.xferTimer||(e.which.buffer.xferTimer=e.which.buffer.xferTicks),e.which.buffer.xfer++;var n;n=e.at.entity.buffers.in==e.which.buffer?"inputTicker":"outputTicker",e.at.entity.$_tags.push(n,!0)}}else"buffer"==e.type.string&&t.processTEMP(e.player.inventory,"inventory.consume",{itemStacks:{name:"iron-chest",count:1}})&&(!e.which.buffer.upgrades.bufferSize&&(e.which.buffer.upgrades.bufferSize={count:0}),e.which.buffer.upgrades.bufferSize.count++,e.which.buffer.stackSize=a[e.which.buffer.upgrades.bufferSize.count]||a.MAX,e.at.entity.$_tags.push("tick","processing"))}),{which:"buffer",type:"string",at:"entity",player:"inventory"}),r.a.addOperation("inventory.add",(function(e,t,n,r){
//! needs to handle a multiplier from args
var i=t.itemStacks;Array.isArray(i)||(i=[i]);for(var o,s=0,a=c(i);!(o=a()).done;){var u=o.value;if(!u.count&&u.amount&&(u.count=u.amount),0!=u.count){var l=u.count*(t.multi||1);s=r.data.item[u.name].stack_size;for(var m=f(e.items,u.name,s);m>-1&&l>0;){var p=Math.min(s-e.items[m].count,l);l-=p,e.items[m].count+=p,m=f(e.items,u.name,s)}l>0&&(
//! Theoretically, this would be the case of all existing inventory
//!   is different than the item or full
!e.maxStacks||e.items.length<e.maxStacks?e.items.push({name:u.name,count:l}):r.graphics.error("Inventory Full"))}}n.part=[]})),r.a.addOperation("inventory.consume",(function(e,t,n,r){var i=t.itemStacks;Array.isArray(i)||(i=[i]);for(var o,s=[],a=c(i);!(o=a()).done;){var u=o.value;!u.count&&u.amount&&(u.count=u.amount);for(var l=f(e.items,u.name),m=u.count*(t.multi||1);l>-1&&m;){var p=Math.min(e.items[l].count,m);e.items[l].count-=p,m-=p,l=f(e.items,u.name)}if(s.push({name:u.name,count:u.count*(t.multi||1)-m}),m)
//! we have failed to consume all
return r.processTEMP(e,"inventory.add",{itemStacks:s}),n._result=!1,n}n._result=!0})),r.a.addOperation("inventory.total",l),r.a.addUtility_CCC("inventory.total",l);var m=void 0,p={land:{total:100,used:0,complexity:0,res_patches:1,res_patch_used:0,fac_block_costs:{factory:100,bus:100,research:100}},scanning:{nextCost:100,currentCost:0},attackWaves:{nextTimer:100,nextStrength:100,currentTimer:0},facBlocks:{defenses:null,defenseBus:null,offense:null,offenseBus:null,buses:[],blocks:[]},player:{inv:{items:[]},workshop:{entities:[]}},activeFeatures:[],version:i.a},d=function(){r.a.defineObj("#",p),r.a.defineObj("#.facBlocks","factoryBlocksBase"),r.a.defineObj("player","player"),r.a.amendObject("FactoryBlocksBase",{tickFn:function(e,t){y(e,t)}}),console.log("setup complete")},y=function(e,t){var n,r,i,o;e.ticks%100||((null==t||null==(n=t.offenses)||null==(r=n.machines.radar)?void 0:r.count)&&(m.globals.scanning.currentCost+=1*t.offenses.machines.radar.count,m.globals.scanning.currentCost>=m.globals.scanning.nextCost&&(m.globals.scanning.currentCost-=m.globals.scanning.nextCost,m.globals.scanning.nextCost+=20,m.globals.land.total+=10,m.globals.land.res_patches=Math.floor(m.globals.land.total/100))),(null==t||null==(i=t.defenses)||null==(o=i.machines.turret)?void 0:o.count)&&(m.globals.attackWaves.currentTimer>m.globals.attackWaves.nextTimer?(m.globals.attackWaves.nextTimer=1.2^m.globals.attackWaves.nextTimer,m.globals.attackWaves.currentTime=0):m.globals.attackWaves.currentTimer++))}},wb4v:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));n("+Aae");var r=n("EfK0"),i=n("0d46");function o(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function a(e){var t=e.from,n=e.to,i=e.options;if((null==i?void 0:i.debug)&&(console.log("debug:"),console.log(t),console.log(n),console.log(i)),0!=(null==i?void 0:i.maxXfer)){var s="entity"==(null==i?void 0:i.toAs)?"recieveItem":"addStack",a=0,c=function(e){(null==i?void 0:i.debug)&&console.log(e);var o=n[s](e);return(null==i?void 0:i.debug)&&console.log(o),o&&t.consumeAll(new r.b(e.name,o)),null==i||i.debug,o},u=(null==i?void 0:i.maxXfer)?function(e){return Math.min(e,i.maxXfer-a)}:function(e){return e};if(null==i?void 0:i.stacks)for(var f,l=o(i.stacks);!(f=l()).done;){c(f.value)}else for(var m,p=o(t.items);!(m=p()).done;){var d=m.value;if(d&&d.name&&0!=d.count&&((!(null==i?void 0:i.types)||i.types.includes(d.name))&&(a+=c({name:d.name,count:u(d.count)}),(null==i?void 0:i.debug)&&console.log("accum: "+a),(null==i?void 0:i.maxXfer)&&i.maxXfer==a)))return}}}i.b.provide("invXfer",a),i.b.provide("invUse",(function(e){switch(e.how){case"sub-n-crement":0===e.from.consume(e.what,e.count)&&(e.to_prop?e.to[e.to_prop]+=e.count:e.to+=e.count)}}))}}]);
//# sourceMappingURL=app~b07b7304.dd10d57561e2868ed30f.bundle.map