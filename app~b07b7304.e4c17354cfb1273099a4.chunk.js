(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{FzzP:function(e,t,n){"use strict";function r(){var e={};return e[Symbol.iterator]=function(){return Object.keys(this)},e}n.d(t,"a",(function(){return r}))},iVgR:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var r=n("7jDb"),i=n("463H");r.a.provide_CCC("player.inventoryPush",(function(e,t){e.which.itemStack.count>0&&t.data.entity[e.which.itemStack.name]&&t.addNewObject(e.to.entities,"player.entity",{name:e.which.itemStack.name})&&e.which.itemStack.count--}),{which:"itemStack",to:"entities"});var o=n("6juG"),a=function(e,t,n){e.processing&&!e.buffers.out.items.some((function(t){return t.count>=e.buffers.out.stackSize}))?(e.process_timer&&--e.process_timer,0===e.process_timer&&n.processTEMP(e.buffers.out,"inventory.add",{itemStacks:e.processing.results||{name:e.processing.mining_results,count:1}})&&(e.process_timer=NaN),Number.isNaN(e.process_timer)&&("miner"==e.subType||n.processTEMP(e.buffers.in,"inventory.consume",{itemStacks:e.processing.ingredients})?e.process_timer=e.process_ticks:e.$_tags.delete("ticking"))):e.$_tags.delete("ticking")};r.a.defineObj("player.entity",(function(e,t,n){return t.buffers={},Object.assign(t,n.data.entity[e.name]),"miner"!=t.subType&&"crafter"!=t.subType||(t.buffers.out={items:[],upgrades:{},stacks:1,stackSize:5,xfer:0,xferTicks:120,xferTimer:NaN}),"crafter"!=t.subType&&"research"!=t.subType||(t.buffers.in={items:[],upgrades:{},stacks:1,stackSize:5,xfer:0,xferTicks:120,xferTimer:NaN}),//!  This won't work when Igor is in a webworker
o.b.signaler.signal("addedEntity"),[t]}),{tick:a}),r.a.addObjectTickFunction("player.entity",a,{});var s=function(e,t,n){n.res?(window.clearTimeout(n.timeout),t.view.animsUpdate(n.res,null,null),n.res=void 0):(n.timeout=window.setTimeout((function(){t.processTEMP(e.player.inventory,"inventory.add",{itemStacks:[{name:e.which.resource.mining_results,count:1}]}),t.view.animsUpdate(n.res,null,null),n.res=void 0}),1e3*e.which.resource.mining_time),n.res=e.which.resource,t.view.animsUpdate(e.which.resource,"isMining",e.which.resource.mining_time))};window.ResourceMine=s;r.a.provide_CCC("resources.mine",s,{which:"resource",player:"inventory"});r.a.provide_CCC("entity.setProcess",(function(e,t){if(!e.at.entity.processing&&null!=e.which.process||(t.processTEMP(e.at.entity,"entity.clearProcess",{returnTo:e.player.inventory}),e.which.process))if(e.at.entity.processing=e.which.process,e.at.entity.$_tags.push("ticking","processing"),"mining"==e.type.class)e.at.entity.process_ticks=e.which.process.mining_time/e.at.entity.mining_speed*t.config.TICKS_PER_SECOND,e.at.entity.process_timer=NaN;else if("crafting"==e.type.class){if(e.at.entity.process_ticks=e.which.process.crafting_speed/e.at.entity.crafting_speed*t.config.TICKS_PER_SECOND,e.at.entity.buffers.in){if(e.at.entity.buffers.in.stacks<e.which.process.ingredients.length)return void console.error("cannot fit ingredients");e.which.process.ingredients.forEach((function(t,n){e.at.entity.buffers.in.items[n]={name:t.name,count:0}}))}if(e.at.entity.buffers.out){if(e.at.entity.buffers.out.stacks<e.which.process.results.length)return void console.error("cannot fit results");e.which.process.results.forEach((function(t,n){e.at.entity.buffers.out.items[n]={name:t.name,count:0}}))}e.at.entity.process_timer=NaN}}),{at:"entity",which:"process",type:"class",player:"inventory"}),r.a.addOperation("entity.clearProcess",(function(e,t,n,r){e.buffers.in&&(r.processTEMP(t.returnTo,"inventory.add",{itemStacks:e.buffers.in.items}),//! If args.returnTo is full, 'inventory.add' will fail silently
e.buffers.in.items.length=0),e.buffers.out&&(r.processTEMP(t.returnTo,"inventory.add",{itemStacks:e.buffers.out.items}),//! If args.returnTo is full, 'inventory.add' will fail silently
e.buffers.out.items.length=0),e.processing=null}));r.a.provide_CCC("entity.bufferCollect",(function(e,t){t.processTEMP(e.player.inventory,"inventory.add",{itemStacks:e.which.buffer}),e.which.buffer.count=0,e.at.entity.$_tags.push("ticking","processing")}),{which:"buffer",at:"entity",player:"inventory"});function c(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}
//! I don't think these will work under all circumstances,
function l(e,t,n){if(n){for(var r,i=-1,o=4,a=c(e.entries());!(r=a()).done;){var s=r.value,u=s[0],l=s[1];o>3&&!l&&(o=3,i=u),o>2&&l&&0==l.count&&(o=2,i=u),o>1&&l&&l.name==t&&l.count<n&&(o=1,i=u)}return 2==o&&(e[i].name=t,e[i].icon=null),i}var f=e.slice().reverse().findIndex((function(e){return e&&e.name==t&&e.count>0}));return-1==f?-1:e.length-1-f}function f(e,t,n,r){if(t.name){n.count=0;for(var i,o=c(e);!(i=o()).done;){var a=i.value;a.name==t.name&&(n.count+=a.count)}n._result=n.count}else if(t.names)for(var s,u=c(e);!(s=u()).done;){var l=s.value;t.names.indexOf(l.name)>-1&&(n[l.name]?n[l.name]+=l.count:n[l.name]=l.count)}}r.a.provide_CCC("entity.bufferFill",(function(e,t){var n=t.processTEMP(e.player.inventory.items,"inventory.total",{name:e.item.buffer.name});if(0!==n){var r=e.service.rounder.calc(e.item.buffer.count,e.which.buffer.stackSize,n);t.processTEMP(e.player.inventory,"inventory.consume",{itemStacks:{name:e.item.buffer.name,count:r}}),e.item.buffer.count+=r,e.at.entity.$_tags.push("ticking","processing")}}),{which:"buffer",item:"buffer",at:"entity",service:"rounder",player:"inventory"}),r.a.addOperation("inventory.add",(function(e,t,n,r){
//! needs to handle a multiplier from args
var i=t.itemStacks;Array.isArray(i)||(i=[i]);for(var o,a=0,s=c(i);!(o=s()).done;){var u=o.value;if(!u.count&&u.amount&&(u.count=u.amount),0!=u.count){var f=u.count*(t.multi||1);a=r.data.item[u.name].stack_size;for(var m=l(e.items,u.name,a);m>-1&&f>0;){var d=Math.min(a-e.items[m].count,f);f-=d,e.items[m].count+=d,m=l(e.items,u.name,a)}f>0&&(
//! Theoretically, this would be the case of all existing inventory
//!   is different than the item or full
!e.maxStacks||e.items.length<e.maxStacks?e.items.push({name:u.name,count:f}):r.graphics.error("Inventory Full"))}}n.part=[]})),r.a.addOperation("inventory.consume",(function(e,t,n,r){var i=t.itemStacks;Array.isArray(i)||(i=[i]);for(var o,a=[],s=c(i);!(o=s()).done;){var u=o.value;!u.count&&u.amount&&(u.count=u.amount);for(var f=l(e.items,u.name),m=u.count*(t.multi||1);f>-1&&m;){var d=Math.min(e.items[f].count,m);e.items[f].count-=d,m-=d,f=l(e.items,u.name)}if(a.push({name:u.name,count:u.count*(t.multi||1)-m}),m)
//! we have failed to consume all
return r.processTEMP(e,"inventory.add",{itemStacks:a}),n._result=!1,n}n._result=!0})),r.a.addOperation("inventory.total",f),r.a.addUtility_CCC("inventory.total",f);var m=void 0,d={land:{total:100,used:0,complexity:0,res_patches:1,res_patch_used:0,fac_block_costs:{factory:100,bus:100,research:100}},scanning:{nextCost:100,currentCost:0},attackWaves:{nextTimer:100,nextStrength:100,currentTimer:0},facBlocks:{defenses:null,defenseBus:null,offense:null,offenseBus:null,buses:[],blocks:[]},player:{inv:{items:[]},workshop:{entities:[]}},activeFeatures:[],version:i.a},p=function(){r.a.defineObj("#",d),r.a.defineObj("#.facBlocks","factoryBlocksBase"),r.a.defineObj("player","player"),r.a.amendObject("FactoryBlocksBase",{tickFn:function(e,t){y(e,t)}}),console.log("setup complete")},y=function(e,t){var n,r,i,o;e.ticks%100||((null==t||null==(n=t.offenses)||null==(r=n.machines.radar)?void 0:r.count)&&(m.globals.scanning.currentCost+=1*t.offenses.machines.radar.count,m.globals.scanning.currentCost>=m.globals.scanning.nextCost&&(m.globals.scanning.currentCost-=m.globals.scanning.nextCost,m.globals.scanning.nextCost+=20,m.globals.land.total+=10,m.globals.land.res_patches=Math.floor(m.globals.land.total/100))),(null==t||null==(i=t.defenses)||null==(o=i.machines.turret)?void 0:o.count)&&(m.globals.attackWaves.currentTimer>m.globals.attackWaves.nextTimer?(m.globals.attackWaves.nextTimer=1.2^m.globals.attackWaves.nextTimer,m.globals.attackWaves.currentTime=0):m.globals.attackWaves.currentTimer++))}},wb4v:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));n("+Aae");var r=n("EfK0"),i=n("0d46");function o(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function s(e){var t=e.from,n=e.to,i=e.options;if((null==i?void 0:i.debug)&&(console.log("debug:"),console.log(t),console.log(n),console.log(i)),0!=(null==i?void 0:i.maxXfer)){var a="entity"==(null==i?void 0:i.toAs)?"recieveItem":"addStack",s=0,c=function(e){(null==i?void 0:i.debug)&&console.log(e);var o=n[a](e);return(null==i?void 0:i.debug)&&console.log(o),o&&t.consumeAll(new r.b(e.name,o)),null==i||i.debug,o},u=(null==i?void 0:i.maxXfer)?function(e){return Math.min(e,i.maxXfer-s)}:function(e){return e};if(null==i?void 0:i.stacks)for(var l,f=o(i.stacks);!(l=f()).done;){c(l.value)}else for(var m,d=o(t.items);!(m=d()).done;){var p=m.value;if(p&&p.name&&0!=p.count&&((!(null==i?void 0:i.types)||i.types.includes(p.name))&&(s+=c({name:p.name,count:u(p.count)}),(null==i?void 0:i.debug)&&console.log("accum: "+s),(null==i?void 0:i.maxXfer)&&i.maxXfer==s)))return}}}i.b.provide("invXfer",s),i.b.provide("invUse",(function(e){switch(e.how){case"sub-n-crement":0===e.from.consume(e.what,e.count)&&(e.to_prop?e.to[e.to_prop]+=e.count:e.to+=e.count)}}))}}]);
//# sourceMappingURL=app~b07b7304.e4c17354cfb1273099a4.bundle.map