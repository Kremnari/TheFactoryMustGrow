(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{app:function(e,t,n){"use strict";n.r(t),n.d(t,"App",(function(){return p}));var a,r=n("aurelia-templating-resources"),i=n("aurelia-framework"),s=n("uShe"),o=n("463H"),c=n("3Qvj"),u=n("0d46"),h=n("6juG"),l=n("7jDb"),v=(n("iVgR"),n("XkjI")),m=n("Evr9");function d(e,t,n,a,r,i,s){try{var o=e[i](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(a,r)}function g(e){return function(){var t=this,n=arguments;return new Promise((function(a,r){var i=e.apply(t,n);function s(e){d(i,a,r,s,o,"next",e)}function o(e){d(i,a,r,s,o,"throw",e)}s(void 0)}))}}function f(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var p=Object(i.d)(r.a,i.b,c.a)(a=function(){function e(e,t,n){var a=this;this.showTut=!0,this.dataBase={},this.viewRecCat=!1,window.tfmg=this,this.Math=Math,this.signaler=e,this.IgorJs=l.a,h.a.signaler=this.signaler,h.a.app=this,this.view=h.c,this.DS=n,this.view.set({type:"view",which:"main",what:"home"}),this.view.set({type:"context",what:"standard"}),this.CCC=u.a,this.Tutorial=m.a,this.save=function(){l.a.saveGame(),a.autoSave(),a.autoSave()},t.expressionObserver(this,"view.ctrl.main").subscribe((function(e,t){a.whenCheck(e,t,"main")})),this.Igor_init()}var t,n,a,r=e.prototype;return r.Igor_init=function(){var e=g(regeneratorRuntime.mark((function e(){var t,n,a,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=location.href.slice(0,location.href.lastIndexOf("/")),e.next=3,fetch(t+"/tfmg_base_config.json5");case 3:return n=e.sent,e.t0=v,e.next=7,n.text();case 7:return e.t1=e.sent,a=e.t0.parse.call(e.t0,e.t1),e.next=11,l.a.initialize({commandTasker:u.b,viewTasker:h.b,ticker:{ticks_per_sec:o.e,ticks_max_phase:o.d},dbName:"TheFactoryMustGrow",dataSets:a});case 11:s.a.onLoadComplete((function(e){r.init(e)})),s.a.beginLoad(a,l.a.getDataSets());case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),r.init=function(){var e=g(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.mgrs=t.mgrs,this.mgrs.baseApp=this,u.b.initialize({dataSet:t.mgrs.data,dialogSvc:this.DS,viewer:h.c}),e.next=5,l.a.loadDatabase(t.mgrs.data);case 5:return this.dataSet=l.a.dataSet,u.b.setRunner(l.a.getRunner()),this.IgorRunner=l.a.getRunner(),this.globals=l.a.getNamed("global"),u.a.staticProvide("player","inventory",this.globals.player.inv),u.a.staticProvide("service","rounder",this.mgrs.rounder),h.a.setClassFn("canCraft",(function(e){return e.ingredients.every((function(e){return n.IgorRunner.processTEMP(n.globals.player.inv.items,"inventory.total",{name:e.name})>=e.amount}))?"recipeEnabled":"recipeDisabled"})),h.a.setViewFn("recipeFilter",(function(e){return Object.values(n.IgorRunner.data.recipe).filter((function(t){return(void 0===t.enabled||t.enabled||n.globals.unlocked_recipes.includes(t.name))&&(Array.isArray(e)&&e.includes(t.category)||t.category==e)})).sort((function(e,t){return e.name<t.name?-1:1}))})),h.a.setViewFn("objectValues",(function(e){return Object.values(e)})),h.a.setViewFn("technologyFilter",(function(){return tfmg.showAllTechs?Object.values(tfmg.dataSet.technology):Object.values(tfmg.dataSet.technology).filter((function(e){var t;return(null==(t=n.globals.research[e.name])?void 0:t.complete)?tfmg.view.options.bDoneTechs:!e.prerequisites||e.prerequisites.every((function(e){var t;return null==(t=n.globals.research[e])?void 0:t.complete}))})).sort((function(e,t){return e.name>t.name?1:-1}))})),h.a.setViewFn("workshopEntities",(function(){var e=n.IgorJs.arrayFromIds(n.globals.player.workshop.entities);return e=e.sort((function(e,t){return e.order>t.order?-1:1}))})),h.a.setViewFn("playerInventory",(function(){var e=n.globals.player.inv.items;return e=e.sort((function(e,t){return e.name==t.name?e.count>t.count?-1:1:e.name>t.name?1:-1}))})),e.next=19,this.mgrs.idb.get("dev");case 19:this.showDev=e.sent,this.showDev||(l.a.setState("start"),this.globals.activeFeatures.tutorial?m.a.start(this):this.autoSave()),h.a.setViewFn("sort",(function(e){return e=e.sort((function(e,t){return e.order>t.order?1:-1}))}));case 22:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.autoSave=function(){var e=this;this.autoSave.sub?(this.IgorJs.Ticker.dispose(this.autoSave.sub),this.autoSave.secs=function(){return 0},this.autoSave.sub=null):(this.autoSave.sub=l.a.Ticker.subscribe((function(){l.a.saveGame()}),o.d/5),this.autoSave.secs=function(){return Math.floor((o.d/5-l.a.Ticker.ticks%(o.d/5)+e.autoSave.sub.phase)/o.e)})},r.when=function(e,t){this.whenTarg={targ:e,cb:t},console.log("whenSet")},r.whenCheck=function(e,t,n){this.whenTarg&&(this.whenTarg.targ.entityPane&&this.view.ctrl.entityPane!=this.whenTarg.targ.entityPane||this.whenTarg.targ.main&&this.view.ctrl.main!=this.whenTarg.targ.main||(this.whenTarg.cb(),this.whenTarg=void 0))},r.isAwesome=function(){this.showAllTechs=!0,this.editDataSource=!0},r.nukeCache=function(){this.mgrs.idb.clear(),window.location.reload()},r.hideTutorial=function(){m.a.clearTut()},r.jumpTutorial=function(){this.IgorRunner.checkAndEmit("system_update","facBlock",{}),this.globals.activeFeatures.tutorial={step:49},m.a.jump(this)},r.copySave=function(){var e=g(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.IgorJs.commands("copySave");case 2:navigator.clipboard.writeText(window.tfmg_save),this.view.goodToast("Copied save to clipboard");case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.resetDS=function(){this.mgrs.idb.del("last_ds"),location.reload()},r.toggleDev=function(){this.mgrs.idb.set("dev",!this.showDev),this.showDev=!this.showDev},r.resetSave=function(){l.a.commands("resetSave")&&location.reload()},r.jumpStart=function(){this.IgorRunner.processTEMP("player.inventory","inventory.add",{itemStacks:[{name:"lab",count:10},{name:"automation-science-pack",count:200},{name:"inserter",count:50},{name:"iron-chest",count:50},{name:"stone",count:100},{name:"burner-mining-drill",count:10},{name:"stone-furnace",count:10},{name:"assembling-machine-1",count:10},{name:"transport-belt",count:100},{name:"logistic-science-pack",count:100},{name:"radar",count:100},{name:"offenseBot",count:100}]}),this.showAllTechs=!0,this.globals.land.total+=400,this.globals.control.bonusTicks=6e4,this.signaler.signal("generalUpdate")},t=e,(n=[{key:"setConnectedItems",set:function(e){var t,n,a={};null==(t=e.item.connections.drains)||t.forEach((function(e){a[e.parent||e]="drain"})),null==(n=e.item.connections.sources)||n.forEach((function(e){a[e.parent||e]+=" source"})),this.view.set({type:"scope",which:"connectedItems",what:a})}}])&&f(t.prototype,n),a&&f(t,a),e}())||a}}]);
//# sourceMappingURL=app~6154e0aa.2b6fb79a089dd2ee6141.bundle.map