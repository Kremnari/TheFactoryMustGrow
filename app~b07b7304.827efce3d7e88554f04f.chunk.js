(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{FzzP:function(e,t,n){"use strict";function r(){var e={};return e[Symbol.iterator]=function(){return Object.keys(this)},e}n.d(t,"a",(function(){return r}))},iVgR:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r=n("7jDb"),i=n("463H");r.a.provide_CCC("player.inventoryPush",(function(e,t){e.which.itemStack.count>0&&t.data.entity[e.which.itemStack.name]&&t.addNewObject(e.to.entities,"player.entity",{name:e.which.itemStack.name})&&(e.which.itemStack.count--,t.view.signaler.signal("addedEntity"))}),{which:"itemStack",to:"entities"});var a=n("6juG");r.a.defineObj("player.entity",(function(e,t,n){return t.buffers={},Object.assign(t,n.data.entity[e.name]),"miner"!=t.subType&&"crafter"!=t.subType||(t.buffers.out=n.newClassObject("entity.buffer",{})),"crafter"!=t.subType&&"research"!=t.subType||(t.buffers.in=n.newClassObject("entity.buffer",{}),"research"==t.subType&&(t.inputs.forEach((function(e){return t.buffers.in.items.push({name:e,count:0})})),t.research_timer=null,t.$_tags.push("researchTicker",!0))),//!  This won't work when Igor is in a webworker
a.b.signaler.signal("addedEntity"),[t]}),{tick:function(e,t,n){e.processing&&!e.buffers.out.items.some((function(t){return t.count>=e.buffers.out.stackSize}))?Number.isNaN(e.process_timer)||null===e.process_timer?"miner"==e.subType||n.processTEMP(e.buffers.in,"inventory.consume",{itemStacks:e.processing.ingredients})?e.process_timer=e.process_ticks:e.$_tags.delete("tick"):(e.process_timer&&--e.process_timer,0===e.process_timer&&n.processTEMP(e.buffers.out,"inventory.add",{itemStacks:e.processing.results||{name:e.processing.mining_results,count:1}})&&(e.process_timer=NaN)):e.$_tags.delete("ticking")}}),r.a.addObjectTickHandler("player.entity",(//!  These should be combined into the entity.buffer tick()
function(e,t,n){if(0==e.buffers.in.xferTimer--){var r=Math.min(e.buffers.in.xfer,e.buffers.in.stackSize-e.buffers.in.items[0].count),i=n.processTEMP(n.getNamedObject("player.inventory"),"inventory.consume",{itemStacks:{name:e.buffers.in.items[0].name,count:r},partial:!0});i&&(e.buffers.in.items[0].count+=i[0].count,e.$_tags.push("tick","processing")),e.buffers.in.xferTimer=e.buffers.in.xferTicks}}),"inputTicker",{chain:["inputTicker","tick"],num:-5}),r.a.addObjectTickHandler("player.entity",(function(e,t,n){if(0==e.buffers.out.xferTimer--){var r=Math.min(e.buffers.out.xfer,e.buffers.out.items[0].count);n.processTEMP(n.getNamedObject("player.inventory"),"inventory.add",{itemStacks:{name:e.buffers.out.items[0].name,count:r}})&&(e.buffers.out.items[0].count-=r),e.buffers.out.xferTimer=e.buffers.out.xferTicks}}),"outputTicker",{chain:["tick","outputTicker"],num:5}),r.a.addObjectTickHandler("player.entity",(function(e,t,n){var r=n.getNamedObject("research").progressing;if(r){if(Number.isNaN(e.research_timer)||null===e.research_timer){if(!r.cost.ingredients.every((function(t){var r=t[0],i=t[1];return n.processTEMP(e.buffers.in.items,"inventory.total",{name:r})>i})))return;return console.log("consuming"),r.cost.ingredients.forEach((function(t){var r=t[0],i=t[1];n.processTEMP(e.buffers.in,"inventory.consume",{itemStacks:{name:r,count:i}})})),void(e.research_timer=120)}e.research_timer&&--e.research_timer,0===e.research_timer&&(n.processTEMP(r,"research.update",{}),e.research_timer=NaN)}}),"researchTicker",{chain:["tick","researchTicker"],num:3});var s=function(e,t,n){n.res?(window.clearTimeout(n.timeout),t.view.animsUpdate(n.res,null,null),n.res=void 0):(n.timeout=window.setTimeout((function(){t.processTEMP(e.player.inventory,"inventory.add",{itemStacks:[{name:e.which.resource.mining_results,count:1}]}),t.view.animsUpdate(n.res,null,null),n.res=void 0}),1e3*e.which.resource.mining_time),n.res=e.which.resource,t.view.animsUpdate(e.which.resource,"isMining",e.which.resource.mining_time))};window.ResourceMine=s,s.signature={which:"resource",player:"inventory"},r.a.provide_CCC("resources.mine",s,s.signature);r.a.provide_CCC("entity.setProcess",(function(e,t){if(!e.at.entity.processing&&null!=e.which.process||(t.processTEMP(e.at.entity,"entity.clearProcess",{returnTo:e.player.inventory}),e.which.process))if(e.at.entity.processing=e.which.process,e.at.entity.$_tags.push("tick","processing"),"mining"==e.type.class)e.at.entity.process_ticks=e.which.process.mining_time/e.at.entity.mining_speed*t.config.TICKS_PER_SECOND,e.at.entity.process_timer=e.at.entity.process_ticks;else if("crafting"==e.type.class){if(e.at.entity.process_ticks=e.which.process.crafting_speed/e.at.entity.crafting_speed*t.config.TICKS_PER_SECOND,e.at.entity.buffers.in){if(e.at.entity.buffers.in.stacks<e.which.process.ingredients.length)return void console.error("cannot fit ingredients");e.which.process.ingredients.forEach((function(t,n){e.at.entity.buffers.in.items[n]={name:t.name,count:0}}))}if(e.at.entity.buffers.out){if(e.at.entity.buffers.out.stacks<e.which.process.results.length)return void console.error("cannot fit results");e.which.process.results.forEach((function(t,n){e.at.entity.buffers.out.items[n]={name:t.name,count:0}}))}e.at.entity.process_timer=NaN}}),{at:"entity",which:"process",type:"class",player:"inventory"}),r.a.addOperation("entity.clearProcess",(function(e,t,n,r){e.buffers.in&&(r.processTEMP(t.returnTo,"inventory.add",{itemStacks:e.buffers.in.items}),//! If args.returnTo is full, 'inventory.add' will fail silently
e.buffers.in.items.length=0),e.buffers.out&&(r.processTEMP(t.returnTo,"inventory.add",{itemStacks:e.buffers.out.items}),//! If args.returnTo is full, 'inventory.add' will fail silently
e.buffers.out.items.length=0),e.processing=null}));var o={Collect:function(e,t){t.processTEMP(e.player.inventory,"inventory.add",{itemStacks:e.which.buffer}),e.which.buffer.count=0,e.at.entity.$_tags.push("tick","processing")}};o.Collect.signature={which:"buffer",at:"entity",player:"inventory"},o.Collect.CC_provide="entity.bufferCollect",o.Fill=function(e,t){var n=t.processTEMP(e.player.inventory.items,"inventory.total",{name:e.item.buffer.name});if(0!==n){var r=e.service.rounder.calc(e.item.buffer.count,e.which.buffer.stackSize,n);t.processTEMP(e.player.inventory,"inventory.consume",{itemStacks:{name:e.item.buffer.name,count:r}}),e.item.buffer.count+=r,e.at.entity.$_tags.push("tick","processing")}},o.Fill.signature={which:"buffer",item:"buffer",at:"entity",service:"rounder",player:"inventory"},o.Fill.CC_provide="entity.bufferFill",r.a.setStatic("entity.buffer.BUFFER_SIZE",[5,10,20,30,40,50]),r.a.setStatic("entity.buffer.BUFFER_SIZE.MAX",50),o.Upgrade=function(e,t){if("autoload"==e.type.string){if(t.processTEMP(e.player.inventory,"inventory.consume",{itemStacks:{name:"inserter",count:1}})){!e.which.buffer.upgrades.loader&&(e.which.buffer.upgrades.loader={count:0}),e.which.buffer.upgrades.loader.count++,e.which.buffer.xferTimer||(e.which.buffer.xferTimer=e.which.buffer.xferTicks),e.which.buffer.xfer++;var n;n=e.at.entity.buffers.in==e.which.buffer?"inputTicker":"outputTicker",e.at.entity.$_tags.push(n,!0)}}else"buffer"==e.type.string&&t.processTEMP(e.player.inventory,"inventory.consume",{itemStacks:{name:"iron-chest",count:1}})&&(!e.which.buffer.upgrades.bufferSize&&(e.which.buffer.upgrades.bufferSize={count:0}),e.which.buffer.upgrades.bufferSize.count++,e.which.buffer.stackSize=t.getStatic("entity.buffer.BUFFER_SIZE")[e.which.buffer.upgrades.bufferSize.count]||t.getStatic("entity.buffer.BUFFER_SIZE.MAX"),e.at.entity.$_tags.push("tick","processing"))},o.Upgrade.signature={which:"buffer",type:"string",at:"entity",player:"inventory"},o.Upgrade.CC_provide="entity.bufferUpgrade",r.a.defineObj("entity.buffer",(function(e,t,n){return t.items=[],t.upgrades={},t.stacks=1,t.stackSize=5,t.xfer=0,t.xferTicks=120,t.xferTimer=NaN,[t]}),o);r.a.provide_CCC("research.set",(function(e,t,n){e.global.game.research.progressing=e.which.tech,e.global.game.research.progressing.completeUnits=0}),{which:"tech",global:"game"});r.a.provide_CCC("research.clear",(function(e,t,n){e.global.game.research.progressing=null}),{global:"game"});r.a.addOperation("research.update",(function(e,t,n,r){e.completeUnits++,e.completeUnits==e.cost.count&&(console.log("complete tech"),r.getNamedObject("research").progressing=null,e.researched=!0,e.unlocks.forEach((function(e){"string"==typeof e&&r.processTEMP(e,"recipe.unlock"),"object"==typeof e&&r.processTEMP(e,"feature.unlock")("string"==typeof e&&r.data.recipe[e]&&(r.data.recipe[e].enabled=!0))})))}));r.a.addOperation("recipe.unlock",(function(e,t,n,r){r.data.recipe[e].enabled=!0}));function c(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}
//! I don't think these will work under all circumstances,
function f(e,t,n){if(n){for(var r,i=-1,a=4,s=c(e.entries());!(r=s()).done;){var o=r.value,u=o[0],f=o[1];a>3&&!f&&(a=3,i=u),a>2&&f&&0==f.count&&(a=2,i=u),a>1&&f&&f.name==t&&f.count<n&&(a=1,i=u)}return 2==a&&(e[i].name=t,e[i].icon=null),i}var l=e.slice().reverse().findIndex((function(e){return e&&e.name==t&&e.count>0}));return-1==l?-1:e.length-1-l}function l(e,t,n,r){if(t.name){n.count=0;for(var i,a=c(e);!(i=a()).done;){var s=i.value;s.name==t.name&&(n.count+=s.count)}n._result=n.count}else if(t.names)for(var o,u=c(e);!(o=u()).done;){var f=o.value;t.names.indexOf(f.name)>-1&&(n[f.name]?n[f.name]+=f.count:n[f.name]=f.count)}}r.a.addOperation("feature.unlock"),r.a.addOperation("inventory.add",(function(e,t,n,r){
//! needs to handle a multiplier from args
var i=t.itemStacks;Array.isArray(i)||(i=[i]);for(var a,s=0,o=c(i);!(a=o()).done;){var u=a.value;if(!u.count&&u.amount&&(u.count=u.amount),0!=u.count){var l=u.count*(t.multi||1);s=r.data.item[u.name].stack_size;for(var m=f(e.items,u.name,s);m>-1&&l>0;){var p=Math.min(s-e.items[m].count,l);l-=p,e.items[m].count+=p,m=f(e.items,u.name,s)}l>0&&(
//! Theoretically, this would be the case of all existing inventory
//!   is different than the item or full
!e.maxStacks||e.items.length<e.maxStacks?e.items.push({name:u.name,count:l}):r.graphics.error("Inventory Full"))}}n.part=[]})),r.a.addOperation("inventory.consume",(function(e,t,n,r){var i=t.itemStacks;Array.isArray(i)||(i=[i]);for(var a,s=[],o=c(i);!(a=o()).done;){var u=a.value;!u.count&&u.amount&&(u.count=u.amount);for(var l=f(e.items,u.name),m=u.count*(t.multi||1);l>-1&&m;){var p=Math.min(e.items[l].count,m);e.items[l].count-=p,m-=p,l=f(e.items,u.name)}if(s.push({name:u.name,count:u.count*(t.multi||1)-m}),m&&!t.partial)
//! we have failed to consume all
return r.processTEMP(e,"inventory.add",{itemStacks:s}),n._result=!1,n}n._result=t.partial&&s||!0})),r.a.addOperation("inventory.total",l),r.a.addUtility_CCC("inventory.total",l);var m=void 0,p={land:{total:100,used:0,complexity:0,res_patches:1,res_patch_used:0,fac_block_costs:{factory:100,bus:100,research:100}},scanning:{nextCost:100,currentCost:0},attackWaves:{nextTimer:100,nextStrength:100,currentTimer:0},facBlocks:{defenses:null,defenseBus:null,offense:null,offenseBus:null,buses:[],blocks:[]},player:{inv:{items:[]},workshop:{entities:[]}},activeFeatures:[],research:{completed:{},progressing:null},version:i.a},d=function(){r.a.defineObj("#",p),r.a.defineObj("#.facBlocks","factoryBlocksBase"),r.a.defineObj("player","player"),r.a.amendObject("FactoryBlocksBase",{tickFn:function(e,t){h(e,t)}}),console.log("setup complete")},h=function(e,t){var n,r,i,a;e.ticks%100||((null==t||null==(n=t.offenses)||null==(r=n.machines.radar)?void 0:r.count)&&(m.globals.scanning.currentCost+=1*t.offenses.machines.radar.count,m.globals.scanning.currentCost>=m.globals.scanning.nextCost&&(m.globals.scanning.currentCost-=m.globals.scanning.nextCost,m.globals.scanning.nextCost+=20,m.globals.land.total+=10,m.globals.land.res_patches=Math.floor(m.globals.land.total/100))),(null==t||null==(i=t.defenses)||null==(a=i.machines.turret)?void 0:a.count)&&(m.globals.attackWaves.currentTimer>m.globals.attackWaves.nextTimer?(m.globals.attackWaves.nextTimer=1.2^m.globals.attackWaves.nextTimer,m.globals.attackWaves.currentTime=0):m.globals.attackWaves.currentTimer++))}},wb4v:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));n("+Aae");var r=n("EfK0"),i=n("0d46");function a(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function o(e){var t=e.from,n=e.to,i=e.options;if((null==i?void 0:i.debug)&&(console.log("debug:"),console.log(t),console.log(n),console.log(i)),0!=(null==i?void 0:i.maxXfer)){var s="entity"==(null==i?void 0:i.toAs)?"recieveItem":"addStack",o=0,c=function(e){(null==i?void 0:i.debug)&&console.log(e);var a=n[s](e);return(null==i?void 0:i.debug)&&console.log(a),a&&t.consumeAll(new r.b(e.name,a)),null==i||i.debug,a},u=(null==i?void 0:i.maxXfer)?function(e){return Math.min(e,i.maxXfer-o)}:function(e){return e};if(null==i?void 0:i.stacks)for(var f,l=a(i.stacks);!(f=l()).done;){c(f.value)}else for(var m,p=a(t.items);!(m=p()).done;){var d=m.value;if(d&&d.name&&0!=d.count&&((!(null==i?void 0:i.types)||i.types.includes(d.name))&&(o+=c({name:d.name,count:u(d.count)}),(null==i?void 0:i.debug)&&console.log("accum: "+o),(null==i?void 0:i.maxXfer)&&i.maxXfer==o)))return}}}i.b.provide("invXfer",o),i.b.provide("invUse",(function(e){switch(e.how){case"sub-n-crement":0===e.from.consume(e.what,e.count)&&(e.to_prop?e.to[e.to_prop]+=e.count:e.to+=e.count)}}))}}]);
//# sourceMappingURL=app~b07b7304.827efce3d7e88554f04f.bundle.map