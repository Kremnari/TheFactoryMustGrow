(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{iVpH:function(e,t,r){"use strict";var n=r("7jDb"),i=r("6juG"),s=function(e,t,r){//!  This won't work when Igor is in a webworker
return t.buffers={},Object.assign(t,r.data.entity[e.name]),"miner"!=t.subType&&"crafter"!=t.subType||(t.buffers.out=r.newComponent("entity.buffer",{})),"crafter"!=t.subType&&"research"!=t.subType||("research"==t.subType?(t.buffers.in=r.newComponent("entity.buffer",{staticStacks:t.inputs}),t.research_timer=null,t.$_tags.push("researchTicker",!0)):t.buffers.in=r.newComponent("entity.buffer",{})),t.order=e.idx,[t]};s._delete=function(e,t){e.buffers.in&&t.deleteObject(e.buffers.in),e.buffers.out&&t.deleteObject(e.buffers.out)},n.a.defineObj("player.entity",s,{tick:function(e,t,r){if(e.processing){if(Number.isNaN(e.process_timer)||null===e.process_timer)"miner"==e.subType||r.processTEMP(e.buffers.in,"inventory.consume",{itemStacks:e.processing.ingredients})?e.process_timer=e.process_ticks:e.$_tags.delete("tick");else if(e.process_timer&&--e.process_timer,0===e.process_timer){var n=r.getId(e.buffers.out),i=r.processTEMP(n,"inventory.add",{itemStacks:e.buffers.stalled||e.processing.results||{name:e.processing.mining_results,count:1}});i.complete?(e.buffers.stalled=null,e.process_timer=NaN):(e.buffers.stalled=i.part,e.process_timer=0)}}else e.$_tags.delete("ticking")}}),n.a.addObjectTickHandler("player.entity",(//!  These should be combined into the entity.buffer tick()
function(e,t,r){var n=r.getId(e.buffers.in);if(0!=n.items.length)if(0==n.xferTimer){var i=Math.min(n.xfer,n.stackSize-n.items[n.xferStack].count),s=r.processTEMP(r.getNamedObject("player.inventory"),"inventory.consume",{itemStacks:{name:n.items[n.xferStack].name,count:i},partial:!0});if(s&&s[0].count>0)n.items[n.xferStack].count+=s[0].count,r.view.signaler.signal("bufferUpdate"),n.stalled=!1,e.$_tags.push("tick","processing");else if(n.items[n.xferStack].count==n.stackSize)return n.stalled=!0,void(n.xferTimer=Math.floor(n.xferTicks/10));n.xferTimer=n.xferTicks,++n.xferStack==n.items.length&&(n.xferStack=0)}else n.xferTimer--}),"inputTicker",{chain:["inputTicker","tick"],num:-5}),n.a.addObjectTickHandler("player.entity",(function(e,t,r){var n=r.getId(e.buffers.out);if(0!=n.items.length)if(0==n.xferTimer){var i=r.getNamedObject("player.inventory");if(r.processTEMP(i,"inventory.total",{name:n.items[n.xferStack].name})>=r.data.item[n.items[n.xferStack].name].stack_size)return n.xferTimer+=Math.floor(n.xferTicks/10),void(n.stalled=!0);n.stalled=!1;var s=Math.min(n.xfer,n.items[n.xferStack].count);r.processTEMP(i,"inventory.add",{itemStacks:{name:n.items[n.xferStack].name,count:s}}).complete&&(n.items[n.xferStack].count-=s,r.view.signaler.signal("bufferUpdate")),n.xferTimer=n.xferTicks,++n.xferStack==n.items.length&&(n.xferStack=0)}else n.xferTimer--}),"outputTicker",{chain:["tick","outputTicker"],num:5}),n.a.addObjectTickHandler("player.entity",(function(e,t,r){var n=r.getNamedObject("research").progressing;if(n){if(Number.isNaN(e.research_timer)||null===e.research_timer){if(!n.cost.ingredients.every((function(t){var n=t[0],i=t[1];return r.processTEMP(e.buffers.in,"inventory.total",{name:n})>=i})))return;return n.cost.ingredients.forEach((function(t){var n=t[0],i=t[1];r.processTEMP(e.buffers.in,"inventory.consume",{itemStacks:{name:n,count:i}})})),e.research_time=n.cost.time*r.config.TICKS_PER_SECOND*e.researching_speed,void(e.research_timer=e.research_time)}e.research_timer&&--e.research_timer,0===e.research_timer&&(r.processTEMP(n,"research.update",{}),e.research_timer=NaN)}}),"researchTicker",{chain:["tick","researchTicker"],num:3});var a=function(e,t,r){r.res?(window.clearTimeout(r.timeout),t.view.animsUpdate(r.res,null,null),r.res=void 0):(r.timeout=window.setTimeout((function(){t.processTEMP(e.player.inventory,"inventory.add",{itemStacks:[{name:e.which.resource.mining_results,count:1}]}),t.view.animsUpdate(r.res,null,null),r.res=void 0}),1e3*e.which.resource.mining_time),r.res=e.which.resource,t.view.animsUpdate(e.which.resource,"isMining",e.which.resource.mining_time))};window.ResourceMine=a,a.signature={which:"resource",player:"inventory"},n.a.provide_CCC("resources.mine",a,a.signature);n.a.provide_CCC("entity.setProcess",(function(e,t){if(!e.at.entity.processing&&null!=e.which.process||(t.processTEMP(e.at.entity,"entity.clearProcess",{returnTo:e.player.inventory}),e.which.process))if(e.at.entity.processing=e.which.process,e.at.entity.$_tags.push("tick","processing"),"mining"==e.type.class)e.at.entity.process_ticks=e.which.process.mining_time/e.at.entity.mining_speed*t.config.TICKS_PER_SECOND,e.at.entity.process_timer=e.at.entity.process_ticks;else if("crafting"==e.type.class){if(e.at.entity.process_ticks=e.which.process.crafting_speed/e.at.entity.crafting_speed*t.config.TICKS_PER_SECOND,e.at.entity.buffers.in){var r=t.getId(e.at.entity.buffers.in);if(r.stacks<e.which.process.ingredients.length)return t.view.warnToast("Recipe exceedes machines ingredient limit");e.which.process.ingredients.forEach((function(e,t){r.items[t]={name:e.name,count:0}}))}if(e.at.entity.buffers.out){var n=t.getId(e.at.entity.buffers.out);if(n.stacks<e.which.process.results.length)return t.view.warnToast("Recipe exceedes machines results limit");e.which.process.results.forEach((function(e,t){n.items[t]={name:e.name,count:0}}))}e.at.entity.process_timer=NaN}}),{at:"entity",which:"process",type:"class",player:"inventory"}),n.a.addOperation("entity.clearProcess",(function(e,t,r,n){if(e.buffers.in){e.process_timer&&n.processTEMP("player.inventory","inventory.add",{itemStacks:e.processing.ingredients});var i=n.getId(e.buffers.in);n.processTEMP("player.inventory","inventory.add",{itemStacks:i.items}),//! If args.returnTo is full, 'inventory.add' will fail silently
i.items.length=0,i.xferStack=0,i.stalled=!1}if(e.buffers.out){var s=n.getId(e.buffers.out);n.processTEMP("player.inventory","inventory.add",{itemStacks:s.items}),//! If args.returnTo is full, 'inventory.add' will fail silently
s.items.length=0,s.xferStack=0,s.stalled=!1}e.buffers.stalled&&(n.processTEMP("player.inventory","inventory.add",{itemStacks:e.buffers.stalled}),e.buffers.stalled=null),e.processing=null})),n.a.setStatic("entityBuffer.sizeExpansionCost",[{name:"iron-chest",count:1}]),n.a.setStatic("entityBuffer.xferExpansionCost",[{name:"inserter",count:1}]);var o=function(e,t,r){var n,i;return t.upgrades={},t.maxStacks=(null==(n=e.staticStacks)?void 0:n.length)||e.stacks||1,t.stackSize=e.stackSize||5,t.items=(null==(i=e.staticStacks)?void 0:i.map((function(e){return{name:e,count:0}})))||[],t.xfer=0,t.xferTicks=120,t.xferStack=0,t.busShift=0,t.xferTimer=NaN,t.restrictable=e.restrictable||!1,t.$_parent=e.$_parent,t.connection=null,[t]};o._delete=function(e,t){var r,n,i=t.getNamedObject("player.inventory");(null==(r=e.upgrades.bufferSize)?void 0:r.count)&&t.processTEMP(i,"inventory.add",{itemStacks:t.getStatic("entityBuffer.sizeExpansionCost"),multi:e.upgrades.bufferSize.count}),(null==(n=e.upgrades.loader)?void 0:n.count)&&t.processTEMP(i,"inventory.add",{itemStacks:t.getStatic("entityBuffer.xferExpansionCost"),multi:e.upgrades.loader.count})};var c={Collect:function(e,t){var r=t.getId(e.which.buffer),n=r.items.findIndex((function(t){return t.name==e.item.name}));if(-1==n&&console.warn("Didnt' find the right index"),0!==r.items[n].count){t.processTEMP(e.player.inventory,"inventory.add",{itemStacks:r.items[n]});r.items[n].count=0,r.stalled=!1,t.view.signaler.signal("bufferUpdate"),"temp_null"!=e.at.entity&&e.at.entity.$_tags.push("tick","processing")}}};c.Collect.signature={which:"buffer",item:"name",at:"entity",player:"inventory"},c.Collect.CC_provide="entity.bufferCollect",c.Fill=function(e,t){var r=t.getId(e.which.buffer),n=r.items.findIndex((function(t){return t.name==e.item.name}));-1==n&&console.warn("Didnt' find the right index");var i=t.processTEMP(e.player.inventory.items,"inventory.total",{name:r.items[n].name});if(0!==i){var s=e.service.rounder.calc(r.items[n].count,r.stackSize,i);t.processTEMP(e.player.inventory,"inventory.consume",{itemStacks:{name:r.items[n].name,count:s}}),r.items[n].count+=s,"temp_null"!=e.at.entity&&e.at.entity.$_tags.push("tick","processing")}},c.Fill.signature={which:"buffer",item:"name",at:"entity",service:"rounder",player:"inventory"},c.Fill.CC_provide="entity.bufferFill",n.a.setStatic("entity.buffer.BUFFER_SIZE",[5,10,20,30,40,50]),n.a.setStatic("entity.buffer.BUFFER_SIZE.MAX",50),c.Upgrade=function(e,t){var r=t.getId(e.which.buffer);if("autoload"==e.type.string){var n;if((null==(n=r.upgrades.loader)?void 0:n.count)>=10)return t.view.warnToast("Loaders full");if(!t.processTEMP(e.player.inventory,"inventory.consume",{itemStacks:{name:"inserter",count:1}}))return t.view.warnToast("Inserter required");!r.upgrades.loader&&(r.upgrades.loader={count:0}),r.upgrades.loader.count++,r.xferTimer||(r.xferTimer=r.xferTicks),r.xfer++;var i;i=e.at.entity.buffers.in==r.$_id?"inputTicker":"outputTicker",e.at.entity.$_tags.push(i,!0)}else if("buffer"==e.type.string){var s;if((null==(s=r.upgrades.bufferSize)?void 0:s.count)>=6)return t.view.warnToast("Chests full");if(!t.processTEMP(e.player.inventory,"inventory.consume",{itemStacks:{name:"iron-chest",count:1}}))return t.view.warnToast("Iron chest required");!r.upgrades.bufferSize&&(r.upgrades.bufferSize={count:0}),r.upgrades.bufferSize.count++,r.stackSize=t.getStatic("entity.buffer.BUFFER_SIZE")[r.upgrades.bufferSize.count]||t.getStatic("entity.buffer.BUFFER_SIZE.MAX"),e.at.entity.$_tags.push("tick","processing")}},c.Upgrade.signature={which:"buffer",type:"string",at:"entity",player:"inventory"},c.Upgrade.CC_provide="entity.bufferUpgrade",c.SetRestrictions=function(e,t,r,n){e.restrictable||(r._result=!1);for(var i=[],s=[],a=0;a<e.items.length;a++){var o=e.items[a];o?t.list.includes(o.name)?i.push(o.name):(o.count>0&&n.processTEMP(n.getNamedObject("player.inventory"),"inventory.add",{itemStacks:o}),e.items.splice(a,1,void 0),s.push(a)):s.push(a)}t.list.forEach((function(t){i.includes(t)||e.items.splice(s.splice(0,1),1,{name:t,count:0})}))},c.SetRestrictions.Igor_operation="buffer.restrictList",c.HasRestriction=function(e,t,r,n){e.restrictable?e.items.forEach((function(e){e.name==t.itemName&&(e.restrictedBy.includes(t.lineId)?r._result={found:!0,restricted:!0}:r._result={found:!0,restricted:!1})})):r._result=!1,!r._result&&(r._result={found:!1,restricted:!1})},c.HasRestriction.Igor_operation="buffer.hasRestriction",c.ClearRestriction=function(e,t,r,n){e.restrictable||(r._result=!1);for(var i=-1;!("_result"in r);){var s=e.items[++i];s.name==t.itemName&&(s.restrictedBy.splice(s.restrictedBy.indexOf(t.lineId),1),0==s.restrictedBy.length?(e.items[i]=null,r._result={found:!0,cleared:!0}):r._result={found:!0,cleared:!1})}!r._result&&(r._result={found:!1,cleared:!1})},c.ClearRestriction.Igor_operation="buffer.clearRestriction",c.BusXfer=function(e,t,r,n){if(t.toBus)for(;t.xferCount>0;){if(!e.items[e.busShift])return null;var i=n.processTEMP(t.toBus,"inventory.add",{itemStacks:[{name:e.items[e.busShift].name,count:t.xferCount}]});if(i.complete)n.processTEMP(e,"inventory.consume",{itemStacks:[{name:e.items[e.busShift].name,count:t.xferCount}]}),t.xferCount=0;else{if(i.part[0].count==t.xferCount)return{full:!0};n.processTEMP(e,"inventory.consume",{itemStacks:[{name:e.items[e.busShift].name,count:t.xferCount-i.part[0].count}]}),t.xferCount=i.part[0].count}++e.busShift==e.items.length&&(e.busShift=0)}else if(t.fromBus)for(;t.xferCount>0;){if(!e.items[e.busShift])return null;var s=n.processTEMP(e,"inventory.add",{itemStacks:[{name:e.items[e.busShift].name,count:t.xferCount}]});if(s.complete)n.processTEMP(t.fromBus,"inventory.consume",{itemStacks:[{name:e.items[e.busShift].name,count:t.xferCount}]}),t.xferCount=0;else{if(s.part[0].count==t.xferCount)return{full:!0};n.processTEMP(t.fromBus,"inventory.consume",{itemStacks:[{name:e.items[e.busShift].name,count:t.xferCount-s.part[0].count}]}),t.xferCount=s.part[0].count}++e.busShift==e.items.length&&(e.busShift=0)}else console.warn("BusXfer called __ no bus target")},c.BusXfer.Igor_operation="buffer.busXfer",n.a.defineObj("entity.buffer",o,c);n.a.provide_CCC("research.set",(function(e,t,r){e.global.game.research.progressing=e.which.tech,e.global.game.research.progressing.completeUnits=0}),{which:"tech",global:"game"});n.a.provide_CCC("research.clear",(function(e,t,r){e.global.game.research.progressing=null}),{global:"game"});n.a.addOperation("research.update",(function(e,t,r,n){var s=n.getNamedObject("global");e.completeUnits++,e.completeUnits==e.cost.count&&(n.view.goodToast("Research Complete: "+e.name),n.getNamedObject("research").progressing=null,e.researched=!0,s.research.completed[e.name]=!0,e.unlocks.forEach((function(e){"string"==typeof e&&n.processTEMP(e,"recipe.unlock"),"object"==typeof e&&n.processTEMP(e,"feature.unlock")})),i.b.signaler.signal("techResearched"))}));n.a.addOperation("recipe.unlock",(function(e,t,r,n){n.getNamedObject("global").unlocked_recipes.push(e)}));n.a.addOperation("feature.unlock",(function(e,t,r,n){n.getNamedObject("global").activeFeatures[e.feature]=e}));var u=function(e,t,r){r.rec?(window.clearTimeout(r.timeout),t.processTEMP(e.player.inventory,"inventory.add",{itemStacks:r.rec.ingredients}),i.b.animsUpdate(r.rec,null,null),r.rec=void 0):t.processTEMP(e.player.inventory,"inventory.consume",{itemStacks:e.which.recipe.ingredients})?(r.rec=e.which.recipe,r.timeout=window.setTimeout((function(){t.processTEMP(e.player.inventory,"inventory.add",{itemStacks:r.rec.results}),i.b.animsUpdate(r.rec,null,null),r.rec=void 0}),1e3*e.which.recipe.crafting_speed),r.rec=e.which.recipe,i.b.animsUpdate(r.rec,"isCrafting",e.which.recipe.crafting_speed)):console.log("cannot craft")};u.signature={which:"recipe",player:"inventory"},n.a.provide_CCC("player.craft",u,u.signature)},wb4v:function(e,t,r){"use strict";r("+Aae");var n=r("EfK0"),i=r("0d46");function s(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return a(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(r=e[Symbol.iterator]()).next.bind(r)}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}i.b.provide("invXfer2",(function(e){var t=e.from,r=e.to,i=e.options;if((null==i?void 0:i.debug)&&(console.log("debug:"),console.log(t),console.log(r),console.log(i)),0!=(null==i?void 0:i.maxXfer)){var a="entity"==(null==i?void 0:i.toAs)?"recieveItem":"addStack",o=0,c=function(e){(null==i?void 0:i.debug)&&console.log(e);var s=r[a](e);return(null==i?void 0:i.debug)&&console.log(s),s&&t.consumeAll(new n.a(e.name,s)),null==i||i.debug,s},u=(null==i?void 0:i.maxXfer)?function(e){return Math.min(e,i.maxXfer-o)}:function(e){return e};if(null==i?void 0:i.stacks)for(var f,l=s(i.stacks);!(f=l()).done;){c(f.value)}else for(var m,p=s(t.items);!(m=p()).done;){var d=m.value;if(d&&d.name&&0!=d.count&&((!(null==i?void 0:i.types)||i.types.includes(d.name))&&(o+=c({name:d.name,count:u(d.count)}),(null==i?void 0:i.debug)&&console.log("accum: "+o),(null==i?void 0:i.maxXfer)&&i.maxXfer==o)))return}}})),i.b.provide("invUse2",(function(e){switch(e.how){case"sub-n-crement":0===e.from.consume(e.what,e.count)&&(e.to_prop?e.to[e.to_prop]+=e.count:e.to+=e.count)}}))}}]);
//# sourceMappingURL=app~2c9954bb.265411a803dd753b71ff.bundle.map