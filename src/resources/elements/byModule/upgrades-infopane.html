<template>
  <scope-var var.bind="$scope.entity = viewPane.showingItem"></scope-var>
  <style>
    .upgrades-infopane icon-base {
      width: 32px;
      height: 32px;
    }
    .upgrades-infopane {
      font-size: 0.9rem;
    }
  </style>
  <div class="upgrades-infopane container">
    <div
      class="row"
      if.bind="$scope.entity.buffers.in"
      click.capture="CCC.provide($event, 'which', 'buffer', $scope.entity.buffers.in)"
      >
      <div>
        <scope-var var.bind="$scope.inBuffer = IgorJs.getObjId($scope.entity.buffers.in)"></scope-var>
        Input Upgrades
      </div>
      <div>
        <icon-base
          item="iron-chest"
          count.bind="$scope.inBuffer.upgrades.bufferSize.count"
          click.delegate="CCC.issue('entity.bufferUpgrade', {'type.string': 'buffer'}, $event)"
          class="${$scope.inBuffer.upgrades.bufferSize.count>=6 && 'countFull'}"
        ></icon-base>
        <icon-base
          item="inserter"
          if.bind="!parcel.isPlayer"
          count.bind="$scope.inBuffer.upgrades.loader.count"
          stalled.bind="$scope.inBuffer.upgrades.loader.count>0 && $scope.inBuffer.stalled"
          progress.bind="($scope.inBuffer.xferTicks-$scope.inBuffer.xferTimer)/$scope.inBuffer.xferTicks*100"
          click.delegate="CCC.issue('entity.bufferUpgrade', {'type.string': 'autoload'}, $event)"
          class="${$scope.inBuffer.upgrades.loader.count>=10 && 'countFull'}"
        ></icon-base>
        <active-trigger
          entity.bind="$scope.inBuffer"
          tag="active"
          if.bind="$scope.inBuffer.xfer>0"
        ></active-trigger>
      </div>
    </div>
    <div
      class="row"
      if.bind="$scope.entity.buffers.out"
      click.capture="CCC.provide($event, 'which', 'buffer', $scope.entity.buffers.out)"
    >
      <div>
        <scope-var var.bind="$scope.outBuffer = IgorJs.getObjId($scope.entity.buffers.out)"></scope-var>
        Output Upgrades
      </div>
      <div>
        <icon-base
          item="iron-chest"
          count.bind="$scope.outBuffer.upgrades.bufferSize.count"
          click.delegate="CCC.issue('entity.bufferUpgrade', {'type.string': 'buffer'}, $event)"
          class="${$scope.outBuffer.upgrades.bufferSize.count>=6 && 'countFull'}"
        ></icon-base>
        <icon-base
          item="inserter"
          if.bind="!parcel.isPlayer"
          count.bind="$scope.outBuffer.upgrades.loader.count"
          stalled.bind="$scope.outBuffer.upgrades.loader.count>0 && $scope.outBuffer.stalled"
          progress.bind="(($scope.outBuffer.xferTicks-$scope.outBuffer.xferTimer)/$scope.outBuffer.xferTicks*100)"
          click.delegate="CCC.issue('entity.bufferUpgrade', {'type.string': 'autoload'}, $event)"
          class="${$scope.outBuffer.upgrades.loader.count>=10 && 'countFull'}"
        ></icon-base>
        <active-trigger
          entity.bind="$scope.outBuffer"
          tag="active"
          if.bind="$scope.outBuffer.xfer>0"
        ></active-trigger>
      </div>
    </div>
  </div>
</template>
