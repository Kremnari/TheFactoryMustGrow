<template>
  <scope-var var.bind="$scope = {crafter: viewPane.showingItem}"></scope-var>
  <require from="../../value-converters/lib/ObjectFilters"></require>
  <style>
    .overflow.recipe {
      max-height: 8rem;
    }
  </style>
  <div class="row mx-0">
    <div class="container-fluid">
      <div class="row">
        <div 
          class="showRecipe col-7"
          if.bind="$scope.crafter.processing"
        >
          <div
            class="row ${$scope.crafter.process_timer!=NaN && 'progressBarBase'}"
            css="border-image-source: linear-gradient(to left, red ${$scope.crafter.process_timer/$scope.crafter.process_ticks*100}%, green ${$scope.crafter.process_timer/$scope.crafter.process_ticks*100}%)"
          > 
            <span class="col">
              <icon-base
                repeat.for="ing of $scope.crafter.processing.ingredients | objectValues"
                item.bind="ing.name"
                required.bind="ing.amount"
                count.bind="CCC.utilityFn('inventory.total', $scope.crafter.buffers.in, {name: ing.name}) & signal:'bufferUpdate'"
                click.delegate="CCC.issue('entity.bufferFill', {'which.buffer': $scope.crafter.buffers.in, 'item.name': ing.name}, $event)"
              ></icon-base>
            </span>
            <span class="recipeBreak">=&gtcc;</span>
            <span class="col">
              <icon-base
                repeat.for="res of $scope.crafter.processing.results | objectValues"
                item.bind="res.name"
                required.bind="res.amount"
                count.bind="CCC.utilityFn('inventory.total', $scope.crafter.buffers.out, {name: res.name}) & signal:'bufferUpdate'"
                click.delegate="CCC.issue('entity.bufferCollect', {'which.buffer': $scope.crafter.buffers.out, 'item.name': res.name}, $event)"
              ></icon-base>
            </span>
          </div>
          <div class="row">
            <span class="col">In Max: ${IgorJs.getObjId($scope.crafter.buffers.in).stackSize}</span>
            <span class="col">Out Max: ${IgorJs.getObjId($scope.crafter.buffers.out).stackSize}</span>
          </div>
          <p click.delegate="CCC.issue('entity.setProcess', {'which.process': null, 'type.class': null}, $event)" class="text-center">Clear recipe</p>
        </div>
        <div if.bind="!$scope.crafter.processing" id="recipeSelect" class="col-7">
          <p>Select recipe to craft</p>
          <div class="overflow recipe">
            <icon-base
              repeat.for="rec of ChameView.viewFn.recipeFilter($scope.crafter.crafting_categories) | objectValues & signal:'techResearched'"
              item.bind="rec"
              click.delegate="CCC.issue('entity.setProcess', {'which.process': rec, 'type.class': 'crafting'}, $event)"
              class="${rec==$scope.crafter.processing ? 'selected': ''}"
              mouseenter.bind="(tooltip = rec) & debounce:2000"
              mouseleave.bind="(tooltip = null) & debounce:2000"
            ></icon-base>
          </div>
        </div>
        <div class="col-5">
          <compose view="resources/elements/byModule/upgrades-infopane.html"></compose>
        </div>
      </div>
    </div>
  </div>
  <div class="row mx-0">
    <div class="col">
      <compose view="resources/elements/byModule/workshop-controls.html"></compose>
    </div>
  </div>
</template>
