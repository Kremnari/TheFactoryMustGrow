<template>
  <scope-var var.bind="$scope = {crafter: viewPane.showingItem}"></scope-var>
  <require from="../../value-converters/lib/ObjectFilters"></require>
  <require from="./upgrades-infopane"></require>
  <div 
    class="showRecipe ${$scope.crafter.process_timer!=NaN && 'progressBarBase'}"
    if.bind="$scope.crafter.processing"
    css="border-image-source: linear-gradient(to left, red ${$scope.crafter.process_timer/$scope.crafter.process_ticks*100}%, green ${$scope.crafter.process_timer/$scope.crafter.process_ticks*100}%)"> 
      Recipe:
      <icon-base
        repeat.for="ing of $scope.crafter.processing.ingredients | objectValues"
        item.bind="ing.name"
        required.bind="ing.amount"
        count.bind="CCC.utilityFn('inventory.total', $scope.crafter.buffers.in, {name: ing.name}) & signal:'generalUpdate'"
        click.delegate="CCC.issue('entity.bufferFill', {'which.buffer': $scope.crafter.buffers.in, 'item.name': ing.name}, $event)"
      ></icon-base>
      =&gtcc;
      <icon-base
        repeat.for="res of $scope.crafter.processing.results | objectValues"
        item.bind="res.name"
        required.bind="res.amount"
        count.bind="CCC.utilityFn('inventory.total', $scope.crafter.buffers.out, {name: res.name}) & signal:'generalUpdate'"
        click.delegate="CCC.issue('entity.bufferCollect', {'which.buffer': $scope.crafter.buffers.out, 'item.name': res.name}, $event)"
      ></icon-base>
    </p>
    <p click.delegate="CCC.issue('entity.setProcess', {'which.process': null, 'type.class': null}, $event)">Clear recipe</p>
  </div>
  <div if.bind="!$scope.crafter.processing" id="recipeSelect">
    <p>Select recipe to craft</p>
    <div class="overflow">
      <icon-base
        repeat.for="rec of ChameView.viewFn.recipeFilter($scope.crafter.crafting_categories) | objectValues & signal:'generalUpdate'"
        item.bind="rec"
        click.delegate="CCC.issue('entity.setProcess', {'which.process': rec, 'type.class': 'crafting'}, $event)"
        class="${rec==$scope.crafter.processing ? 'selected': ''}"
        mouseenter.bind="(tooltip = rec) & debounce:2000"
        mouseleave.bind="(tooltip = null) & debounce:2000"
      ></icon-base>
    </div>
  </div>
  <compose view="resources/elements/byModule/upgrades-infopane.html"></compose>
</template>
