<template>
<scope-var var.bind="$scope={facBlock: viewPane.showingItem}"></scope-var>
<section id="viewFacBlock" click.capture="CCC.provide($event, 'at', 'factoryBlock', $scope.facBlock )" class="container">
  <div class='row'>
    <span class="col">Land Size : ${$scope.facBlock.size}</span>
    <h3 class="col">${$scope.facBlock.name}</h3>
    <span class="col">Complexity: ${$scope.facBlock.complexity}</span>
  </div>
  <div class="row">
    <div
        if.bind="$scope.facBlock.buffers.in"
        click.capture="CCC.provide($event, 'which', 'buffer', $scope.facBlock.buffers.in)"
        class="col">
      Input:
      <span
        class="connection"
        click.delegate="CCC.issue('factoryBus.connectTo', 
          {'$_factoryBusXlist': IgorJs.arrayFromIds(globals.facBlocks.buses), 'to.buffer':  $scope.facBlock.buffers.in,'dir.string': 'input'}, $event)"
      >${IgorJs.getObjId($scope.facBlock.buffers.in, "connection").name || "none" & signal:'generalUpdate'}</span>
      <div>
        <icon-base
          repeat.for="item of IgorJs.getObjId($scope.facBlock.buffers.in).items & signal:'generalUpdate'"
          item.bind="item"
          count.bind="item.count"
          click.delegate="CCC.issue('entity.bufferFill', {'item.name': item.name, 'at.entity': 'temp_null'}, $event)"
        ></icon-base>
      </div>
    </div>
    <div
        if.bind="$scope.facBlock.buffers.internal"
        click.capture="CCC.provide($event, 'which', 'buffer', $scope.facBlock.buffers.internal)"
        class="col">
      Internal:
      <div>
        <span repeat.for="item of IgorJs.getObjId($scope.facBlock.buffers.internal).items & signal:'generalUpdate'">
          <span
              class="fas fa-level-up-alt fa-rotate-90"
              if.bind="item.name"
              click.delegate="CCC.issue('entity.bufferFill', {'item.name': item.name, 'at.entity': 'temp_null'}, $event)"
            ></span>
          <icon-base if.bind="item" item.bind="item" count.bind="item.count"></icon-base>
          <span
            class="fas fa-level-down-alt"
            if.bind="item.name"
            click.delegate="CCC.issue('entity.bufferCollect', {'item.name': item.name, 'at.entity': 'temp_null', }, $event)"
          ></span>
        </span>
      </div>
    </div>
    <div
        if.bind="$scope.facBlock.buffers.out"
        click.capture="CCC.provide($event, 'which', 'buffer', $scope.facBlock.buffers.out)"
        class="col">
      Outputs:
      <span
        class="connection"
        click.delegate="CCC.issue('factoryBus.connectTo',
        {'$_factoryBusXlist': IgorJs.arrayFromIds(globals.facBlocks.buses), 'to.buffer':  $scope.facBlock.buffers.out,'dir.string': 'output'}, $event)"
      >${IgorJs.getObjId($scope.facBlock.buffers.out, "connection").name || "none" & signal:'generalUpdate'}</span>
      <div>
        <icon-base 
          repeat.for="item of IgorJs.getObjId($scope.facBlock.buffers.out).items & signal:'generalUpdate'"
          if.bind="item" 
          item.bind="item" 
          count.bind="item.count"
          click.delegate="CCC.issue('entity.bufferCollect', {'item.name': item.name, 'at.entity': 'temp_null'}, $event)"
        ></icon-base>
      </div>
    </div>
  </div>
  <div
    class="productionLines row"
    repeat.for="line of IgorJs.arrayFromIds($scope.facBlock.factoryLines) & signal:'generalUpdate'"
    click.capture="CCC.provide($event, 'at', 'factoryLine', line)"
    >
    <span
      if.bind="line.buildingType"
      click.delegate="CCC.issue('factoryLine.setRecipe', {$_recipeXlist: ChameView.viewFn.recipeFilter(line.crafting_categories, true)}, $event)"
      >
      Recipe: 
        <icon-base
          if.bind="line.recipe"
          item.bind="line.recipe"
          class="progressBarBase"
          css="border-image-source: linear-gradient(to right, green ${line.processing_ticks/line.processing_time*100-5}%, red ${line.processing_ticks/line.processing_time*100+10}% )"
          ></icon-base>
        <span if.bind="!line.recipe">None</span>
    </span>
    <br>
    <span>
      <span if.bind="!line.buildingType" click.delegate="CCC.issue('factoryLine.setBuilding', null, $event)">Set Building Type...</span>
      <span if.bind=" line.buildingType" click.delegate="CCC.issue('factoryLine.addBuilding', null, $event)">
        <icon-base item.bind="line.buildingType"></icon-base>
        : ${line.built}
      </span>
    </span>
    <span>
      Prepped spaces: ${line.prepped}
      <span click.delegate="CCC.issue('factoryLine.prep', null, $event)">Expand</span>
    </span>
  </div>
  <div note="add new line to factory block" class="row">
    <span click.delegate="CCC.issue('factoryBlock.addLine', null, $event)">Add Line</span>
  </div>
</section>
</template>
