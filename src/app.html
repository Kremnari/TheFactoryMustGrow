<template>
  <require from="bootstrap/dist/css/bootstrap.min.css"></require>
  <require from="@fortawesome/fontawesome-free/css/all.min.css"></require>
  <require from="./styles.scss"></require>
  <require from="./tfmg.scss"></require>
  <require from="resources/elements/tool-tip"></require>

  <div if.bind="viewPane.version=='beta'" beta>
    <require from="./tfmg-beta.scss"></require>
    <section class="statusBox">
      <div if.bind="!tooltip">
        status box<br>
        Land, pollution, enemies, oh my!
      </div>
      <tool-tip display.bind="tooltip" item-mgr.bind="mgrs.item" recipe-mgr.bind="mgrs.rec"></tool-tip>
    </section>
    <nav>
      <span click.delegate="viewPane.main='nav'" class="fas fa-level-up-alt fa-rotate-90 ${viewPane.main=='nav'?'selected':''}"></span>
      <span click.delegate="viewPane.main='menu'" class="fas fa-bars ${viewPane.main=='menu'?'selected':''}" ></span>
      <span click.delegate="viewPane.main='dev'" class="fab fa-dev ${viewPane.main=='dev'?'selected':''}" if.bind="showDev"></span>
      <span class="fas spacer"></span>
      <span click.delegate="viewPane.main='home'" class="fas fa-user navHome ${viewPane.main=='home'?'selected':''}"></span>
      <span click.delegate="viewPane.main='entities'" class="fas fa-toolbox navEntities ${viewPane.main=='entities'?'selected':''}"></span>


      <span click.delegate="viewPane.main='facBlocks'" class="fas fa-industry navFacBlocks ${viewPane.main=='facBlocks'?'selected':''}"></span>
      <span click.delegate="viewPane.main='research'" class="fas fa-drafting-compass navTechs ${viewPane.main=='research'?'selected':''}"></span>
    </nav>
    <main class="tfmg">
      <section id="nav" if.bind="viewPane.main=='nav'">
        <p click.delegate="viewPane.main='nav'"><span class="fas fa-level-up-alt fa-rotate-90 selected" alt="verbose nav"></span>Expanded Nav</p>
        <p click.delegate="viewPane.main='menu'"><span class="fas fa-bars" ></span>Menu</p>
        <p click.delegate="viewPane.main='dev'"><span class="fab fa-dev" if.bind="showDev"></span>Dev Menu</p>
        <p class="fas spacer"></p>

        <p click.delegate="viewPane.main='home'"><span class="fas fa-user navHome"></span>Player Home</p>
        <p click.delegate="viewPane.main='entities'"><span class="fas fa-toolbox navEntities"></span>Workshop</p>
        <p class="fas spacer"></p>
  
        <p click.delegate="viewPane.main='facBlocks'"><span class="fas fa-industry navFacBlocks"></span>Factory Blocks</p>
        <p click.delegate="viewPane.main='research'"><span class="fas fa-drafting-compass navTechs"></span>Technologies</p>
      </section>
      <section id="menu" if.bind="viewPane.main=='menu'" style="z-index:2000">
          <div click.delegate="resetSave()">Reset Save</div>
          <div click.delegate="resetDS()">Reset DataSource</div>
          <div click.delegate="viewPane.version = 'alpha'">Alpha</div>
          <div click.delegate="setDev()" if.bind="!showDev">Set Dev</div>
          <div click.delegate="unsetDev()" if.bind="showDev">Unset Dev</div>
          <div click.delegate="jumpStart()">JumpStart</div>
          <div click.delegate="testing()">Testing()</div>
          <a class="notLink" target="_blank" href="https://digitalpsigen.tech/biz_plans/TFMG_welcome.html">Investor Options <span class="fas fa-external-link-alt"></span></a>
          <div class="iconRow">
            <span class="fas fa-external-link-alt"></span>-&gt;
            <a class="notLink" target="_blank" href="https://github.com/Kremnari/TheFactoryMustGrow"><span class="fab fa-github"></span></a>
          </div>
          <div id="email_sub">
            <span click.delegate="showSubUp=!showSubUp">Subscribe for updates <span class="fas fa-chevron-down"></span>
            <div if.bind="showSubUp">
              <!-- Begin Mailchimp Signup Form -->
              <link href="//cdn-images.mailchimp.com/embedcode/classic-10_7.css" rel="stylesheet" type="text/css">
              <style type="text/css">
                #mc_embed_signup{background:darkslategrey; clear:left; font:14px Helvetica,Arial,sans-serif; }
                /* Add your own Mailchimp form style overrides in your site stylesheet or in this style block.
                  We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
              </style>
              <div id="mc_embed_signup">
              <form action="https://digitalpsigen.us1.list-manage.com/subscribe/post?u=cf2e664fb607fff9109a1e9ec&amp;id=9fca87efa8" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
                  <div id="mc_embed_signup_scroll">
                <h2>Subscribe for updates</h2>
              <div class="indicates-required"><span class="asterisk">*</span> indicates required</div>
              <div class="mc-field-group">
                <label for="mce-EMAIL">Email Address  <span class="asterisk">*</span>
              </label>
                <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL">
              </div>
              <div class="mc-field-group">
                <label for="mce-FNAME">First Name </label>
                <input type="text" value="" name="FNAME" class="" id="mce-FNAME">
              </div>
              <div class="mc-field-group">
                <label for="mce-LNAME">Last Name </label>
                <input type="text" value="" name="LNAME" class="" id="mce-LNAME">
              </div>
                <div id="mce-responses" class="clear">
                  <div class="response" id="mce-error-response" style="display:none"></div>
                  <div class="response" id="mce-success-response" style="display:none"></div>
                </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
                  <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_cf2e664fb607fff9109a1e9ec_9fca87efa8" tabindex="-1" value=""></div>
                  <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
                  </div>
                  <span>Service provided by MailChimp</span>
              </form>
              </div>
              <script type='text/javascript' src='//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js'></script><script type='text/javascript'>(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';}(jQuery));var $mcj = jQuery.noConflict(true);</script>
              <!--End mc_embed_signup-->
            </div>
          </div>
      </section>
      <section id="devControls" if.bind="viewPane.main=='dev'">
        <div click.delegate="save()">Save</div>
        <div click.delegate="resetSave()">Start Anew</div>
        <div click.delegate="mgrs.Ticker.once()">Tick 1</div>
        <div click.delegate="mgrs.Ticker.toggle()">${mgrs.Ticker.isRunning ? "Pause" : "Resume"}</div>
        <div click.delegate="testing()">Testing...</div>
        <!-- button click.delegate="iconEditor()">Edit Icons</!-->
        <div click.delegate="viewPane.version = 'editData'">Edit DataSource</div>
      </section>
      <section id="playerHome" show.bind="viewPane.main=='home'">
        <h3>Craftables</h3>
        <div class="overflow" id="recipes">
          <icon-base
            repeat.for="rec of mgrs.rec.recipes_by_cats['crafting']  | objectValues "
            item.bind="rec"
            title = "${rec.name}"
            click.delegate="mgrs.rec.startCraft(rec, player.inv, ' ')"
            show.bind="rec.enabled"
            class.bind="rec.classesStr"
            anim_class.bind="rec.style"
            mouseenter.trigger="tooltip = rec"
            mouseleave.trigger="tooltip = null"
          ></icon-base>
        </div>
        <div id="resources">
          <h3>Mineables</h3>
          <icon-base repeat.for="res of mgrs.res.resList | canMine | objectValues" item.bind="res" click.delegate="mgrs.res.mine(res.name, player.inv)"
                    class="${res.mining ? 'mining': null}" anim_style.bind="res.miningStyle"></icon-base> 
        </div>
        <div id="inventoryList">
          <h3>Inventory</h3>
          <inventory
            items.bind="player.inv.items"
            click-call.call="player.inv.click({
              where:viewPane.facBlock, which: item
              ,who: player, what:'use'
              })"
            ></inventory>
        </div>
      </section>
      <section id="machines" show.bind="viewPane.main=='entities'">
        <div show.bind="viewPlayer">
          <div show.bind="viewPane.entityPane == 'mining'">
            <h4>Workshop</h4>
            <require from="./resources/elements/byModule/mining-infopane.html"></require>
            <require from="./resources/elements/byModule/lab-infopane.html"></require>
            <require from="./resources/elements/byModule/crafting-infopane.html"></require>
            <mining-infopane if.bind="viewPane.showingItem['mining_speed']" miner.bind="viewPane.showingItem" actor.bind="player" res-mgr.bind="mgrs.res" rounder.bind="rounder"></mining-infopane>
            <crafting-infopane if.bind="viewPane.showingItem['crafting_speed']" crafter.bind="viewPane.showingItem" rec-mgr.bind="mgrs.rec" item-mgr.bind="mgrs.item" actor.bind="player" inventory.bind="viewPane.facBlock.inv" rounder.bind="rounder"></crafting-infopane>
            <lab-infopane if.bind="viewPane.showingItem['researching_speed']" lab.bind="viewPane.showingItem" item-mgr.bind="mgrs.item" rounder.bind="rounder"></lab-infopane>
            <div class="entityList">
              <icon-base
                repeat.for="machina of viewPane.facBlock.getEntities() & signal:'addedEntity'"
                item.bind="machina"
                alt-image.bind="machina.recipe.icon || machina.mining.icon"
                click.delegate="showing(machina)"
                class.bind="machina.selectedClass"
              ></icon-base>
            </div>
          </div>
          <div id="inventoryList">
            <h3>Inventory</h3>
            <inventory
              items.bind="player.inv.items"
              click-call.call="player.inv.click({
                where:viewPane.facBlock, which: item
                ,who: player, what:'use'
                })"
              ></inventory>
          </div>
        </div>
        <div show.bind="!viewPlayer">
          <require from="resources/elements/factoryBlocks/transportLine.html" as="transport-line"></require>
          <require from="resources/elements/factoryBlocks/entityLine" as="entity-line"></require>
          <require from="resources/elements/factoryBlocks/TransportLineUpgrades.html" as="tlu"></require>
          Block Name: ${viewPane.facBlock.name}
          <div if.bind="viewPane.facBlock.inputLine">
            <p>
              Feed From: ${viewPane.facBlock.feeds[0].name}
              <span click.delegate="viewPane.facBlock.SelectBusFeed()">(Change)</span>
            </p>
            <transport-line
              if.bind="viewPane.facBlock.inputLine"
              line.bind="viewPane.facBlock.inputLine"
              inv-click.call="CC.InvXFer(inv, player.inv, {stacks: [item]})"
              type="input"
            ></transport-line>
            <tlu 
              upgrades.bind="viewPane.facBlock.upgrades.input"
              apply-upgrade.call="viewPane.facBlock.ApplyUpgrade({
                upgrade
                ,inv: player.inv
                ,line: viewPane.facBlock.inputLine
              })"
            ></tlu>
            <hr>
          </div>
          <div repeat.for="line of viewPane.facBlock.lines">
            <transport-line
              if.bind="line.items"
              line.bind="line"
              type="internal"
            ></transport-line>
            <entity-line
              if.bind="line.entities"
              line.bind="line"
            ></entity-line>
          </div>
          <div if.bind="viewPane.facBlock.outputLine">
            <hr>
            <p>
              Drains To: ${viewPane.facBlock.drains[0].name}
              <span click.delegate="viewPane.facBlock.SelectBusDrain()">(Change)</span>
            </p>
            <tlu
              upgrades.bind="viewPane.facBlock.upgrades.output"
              apply-upgrade.call="viewPane.facBlock.ApplyUpgrade({
                upgrade
                ,inv: player.inv
                ,line: viewPane.facBlock.outputLine
              })"
            ></tlu>
            <transport-line
              if.bind="viewPane.facBlock.outputLine"
              line.bind="viewPane.facBlock.outputLine"
              inv-click.call="CC.InvXFer(inv, player.inv, {stacks: [item]})"
              type="output"
            ></transport-line>
          </div>
        </div>
      </section>
      <section id="facBlocks" show.bind="viewPane.main=='facBlocks'">
        <h3>Factory Blocks</h3>
        <div click.delegate="select_FacBlock(player, true)" class='${viewPane.facBlock==player ? "selected":""}'>Player Workshop</div>
        <div repeat.for="facBlock of facBlocks" click.delegate="select_FacBlock(facBlock)" class='${viewPane.facBlock==facBlock ? "selected":""}'>
          ${facBlock.name}:${facBlock.type}
        </div>
        <div>
          <span class="button" click.delegate="add_FacBlock('factory')">Add Factory Block</span>
          <span class="button" click.delegate="add_FacBlock('bus')">Add Bus Block</span>
          <span class="button" click.delegate="add_FacBlock('resource')">Add Resource Block</span>
          <span class="button" click.delegate="add_FacBlock('research')">Add Lab Block</span>
        </div>
      </section>
      <section id="technologies" show.bind="viewPane.main=='research'">
        <h3>Research</h3>
        <require from="./resources/elements/byModule/tech-infopane.html"></require>
        <tech-infopane if.bind="viewPane.showingCat=='tech'" tech.bind="viewPane.showingItem" tech-mgr.bind="mgrs.tech" tooltip.bind="tooltip"></tech-infopane>
        <div class="overflow">
          <icon-base repeat.for="tech of mgrs.tech.shownTechs & signal:'techUpdate'" click.delegate="showItem = {item: tech, cat: 'tech'}"
                      item.bind="tech" count.bind="tech.prerequisites.length"
                      class="${mgrs.tech.researching==tech ? 'researching' : ''} ${tech.researched ? 'researched': ''} ${viewPane.showingItem==tech ? 'selected': ''}"
          >
          </icon-base>
        </div>
        <div>
          <h5>Filters</h5>
          <p>Filter Complete<button click.delegate="mgrs.tech.toggleFilter('complete')">${mgrs.tech.filters.ShowComplete? "Hide":"Show"}</button></p>
          <p>Filter Pack:
            <span repeat.for="pack of mgrs.tech.filters.ShowPack | objectEntries & signal:'techUpdate'"
              class="${pack[1]? 'selected':''}" click.delegate="mgrs.tech.toggleFilter('byPack', pack[0])"
              >
              <img src.bind="mgrs.icon.getSrc('item', pack[0])" height="16px">
            </span>
          </p>
        </div>
      </section>
    </main>
    <div id="tutorial">
      <div id="tut_pos" class="center">
        <span id="tut_text"></span>
        <button id="tut_button" class="center"></button>
      </div>
      <span click.delegate="hideTutorial()" note="off">X</span>
    </div>
    <section class="tabs">
      <div id="numSelectors" class="tab tab_bottom_left">
        <input type="checkbox" class="tab_toggle" id="numSelToggle">
        <div class="tab_content">
          <input id="huns" type="range" min="0" max="9" step="1" value.bind="mgrs.rounder.huns">
          <input id="tens" type="range" min="0" max="9" step="1" value.bind="mgrs.rounder.tens">
          <input id="ones" type="range" min="0" max="9" step="1" value.bind="mgrs.rounder.ones">
          <span>${mgrs.rounder.huns}${mgrs.rounder.tens}${mgrs.rounder.ones}</span>
          <label class="switch"><input type="checkbox" value.bind="mgrs.rounder.abs"><span class="slider text_abs_mod"></span></label>
          <label class="switch"><input type="checkbox" value.bind="mgrs.rounder.fail"><span class="slider text_full_part"></span></label>
        </div>
        <label for="numSelToggle">Rounder&nbsp<span class="tabOnly">${mgrs.rounder.huns}${mgrs.rounder.tens}${mgrs.rounder.ones}</span></label>
      </div>
      <div id="filterSelectors" class="tab tab_bottom_right">
        <input type="checkbox" class="tab_toggle" id="filterSelectorToggle">
        <div class="tab_content">
          Yay! Filters
        </div>
        <label for="filterSelectorToggle">Filters</label>
      </div>
    </section>
  </div>
  <div id="editDataSource" if.bind="viewPane.version=='editData'">
    <require from="resources/elements/dataEditor"></require>
    <data-editor></data-editor>
  </div>

  <!-- div if.bind="viewPane.version!='beta'">
    <header id="selector">
      <div id="devControls" if.bind="showDev">
        <button click.delegate="save()">Save</button>
        <button click.delegate="resetSave()">Start Anew</button>
        <button click.delegate="mgrs.Ticker.once()">Tick 1</button>
        <button click.delegate="mgrs.Ticker.toggle()">${mgrs.Ticker.isRunning ? "Pause" : "Resume"}</button>
        <button click.delegate="testing()">Testing...</button>
        <button click.delegate="iconEditor()">Edit Icons</button>
      </div>
      <div id="playerControls">
        <h4 click.delegate="viewPane.main = 'menu'">&#9776;</h4>
        <h4 click.delegate="viewPane.main = 'home'">Home</h4>
        <h4 click.delegate="viewPane.main = 'entities'">Workshop</h4>
        <h4 click.delegate="viewPane.main = 'facBlocks'">Blocks</h4>
        <h4 click.delegate="viewPane.main = 'research'">Research</h4>
      </div>
      <div id="facBlockControls" show.bind="viewPane.facBlock==player">
        <div show.bind="viewPane.main == 'entities'">
          <h5 click.delegate="viewPane.entityPane = 'mining'">Mining</h5>
          <h5 click.delegate="viewPane.entityPane = 'manuf'">Manufacturing</h5>
          <h5 click.delegate="viewPane.entityPane = 'labs'">Labs</h5>
        </div>
      </div>
      <tool-tip display.bind="tooltip" item-mgr.bind="mgrs.item" recipe-mgr.bind="mgrs.rec"></tool-tip>
    </header>
    <div id="mainView" if.bind="viewPane!='iconEditor'">
      <article>
        <section id="recipes" show.bind="viewPane.main == 'home'">
          <h4>Craftables</h4>
          <div class="overflow">
            <icon-base
              repeat.for="rec of mgrs.rec.recipes_by_cats['crafting']  | objectValues "
              item.bind="rec"
              title = "${rec.name}"
              click.delegate="mgrs.rec.startCraft(rec, player.inv, ' ')"
              show.bind="rec.enabled"
              class.bind="rec.classesStr"
              anim_class.bind="rec.style"
              mouseenter.trigger="tooltip = rec"
              mouseleave.trigger="tooltip = null"
            ></icon-base>
          </div>
        </section>
        <section id="resources" show.bind="viewPane.main == 'home'">
          <h3>Mineables</h3>
          <icon-base repeat.for="res of mgrs.res.resList | canMine | objectValues" item.bind="res" click.delegate="mgrs.res.mine(res.name, player.inv)"
                    class="${res.mining ? 'mining': null}" anim_style.bind="res.miningStyle"></icon-base> 
        </section>
        <section id="technologies"  show.bind="viewPane.main == 'research'">
          <h3>Research</h3>
          <require from="./resources/elements/byModule/tech-infopane.html"></require>
          <tech-infopane if.bind="viewPane.showingCat=='tech'" tech.bind="viewPane.showingItem" tech-mgr.bind="mgrs.tech" tooltip.bind="tooltip"></tech-infopane>
          <div class="overflow">
            <icon-base repeat.for="tech of mgrs.tech.shownTechs & signal:'techUpdate'" click.delegate="showItem = {item: tech, cat: 'tech'}"
                        item.bind="tech" count.bind="tech.prerequisites.length"
                        class="${mgrs.tech.researching==tech ? 'researching' : ''} ${tech.researched ? 'researched': ''} ${viewPane.showingItem==tech ? 'selected': ''}"
            >
            </icon-base>
          </div>
          <div>
            <h5>Filters</h5>
            <p>Filter Complete<button click.delegate="mgrs.tech.toggleFilter('complete')">${mgrs.tech.filters.ShowComplete? "Hide":"Show"}</button></p>
            <p>Filter Pack:
              <span repeat.for="pack of mgrs.tech.filters.ShowPack | objectEntries & signal:'techUpdate'"
                class="${pack[1]? 'selected':''}" click.delegate="mgrs.tech.toggleFilter('byPack', pack[0])"
                >
                <img src.bind="mgrs.icon.getSrc('item', pack[0])" height="16px">
              </span>
            </p>
          </div>
        </section>
        <section id="facBlocks" show.bind="viewPane.main == 'facBlocks'">
          <h3>Factory Blocks</h3>
          <div click.delegate="select_FacBlock(player, true)" class='${viewPane.facBlock==player ? "selected":""}'>player</div>
          <div repeat.for="facBlock of facBlocks" click.delegate="select_FacBlock(facBlock)" class='${viewPane.facBlock==facBlock ? "selected":""}'>
            ${facBlock.name}:${facBlock.type}
          </div>
          <div>
            <span class="button" click.delegate="add_FacBlock('factory')">Add Factory Block</span>
            <span class="button" click.delegate="add_FacBlock('bus')">Add Bus Block</span>
            <span class="button" click.delegate="add_FacBlock('resource')">Add Resource Block</span>
            <span class="button" click.delegate="add_FacBlock('research')">Add Lab Block</span>
          </div>
        </section>
        <section id="machines" if.bind="viewPane.main == 'entities' && viewPlayer">
          <div show.bind="viewPane.entityPane == 'mining'">
            <h4>Mining</h4>
            <require from="./resources/elements/byModule/mining-infopane.html"></require>
            <mining-infopane if.bind="viewPane.showingCat=='miner'" miner.bind="viewPane.showingItem" actor.bind="player" res-mgr.bind="mgrs.res" rounder.bind="rounder"></mining-infopane>
            <div class="entityList">
              <icon-base repeat.for="miner of viewPane.facBlock.getEntities('mining') & signal:'addedEntity'" item.bind="miner" alt-image.bind="miner.mining.icon"
                        click.delegate="showing(miner, 'miner')" class.bind="miner.selectedClass"></icon-base>
            </div>
          </div>
          <div show.bind="viewPane.entityPane == 'manuf'">
            <h4>Manufacturing</h4>
            <require from="./resources/elements/byModule/crafting-infopane.html"></require>
            <crafting-infopane if.bind="viewPane.showingCat=='crafter'" crafter.bind="viewPane.showingItem" rec-mgr.bind="mgrs.rec" item-mgr.bind="mgrs.item" actor.bind="player" inventory.bind="viewPane.facBlock.inv" rounder.bind="rounder"></crafting-infopane>
            <div class="entityList">
              <icon-base
                repeat.for="crafter of viewPane.facBlock.getEntities('crafting') & signal:'addedEntity'"
                item.bind="crafter"
                title.bind="crafter.name"
                alt-image.bind="crafter.recipe.icon"
                click.delegate="showing(crafter, 'crafter')"
                class.bind="crafter.selectedClass"
              ></icon-base>
            </div>
          </div>
          <div show.bind="viewPane.entityPane == 'labs'">
            <h4>Labs</h4>
            <require from="./resources/elements/byModule/lab-infopane.html"></require>
            <lab-infopane if.bind="viewPane.showingCat=='labs'" lab.bind="viewPane.showingItem" item-mgr.bind="mgrs.item" rounder.bind="rounder"></lab-infopane>
            <div class="entityList">
              <icon-base repeat.for="labee of viewPane.facBlock.getEntities('lab') & signal:'addedEntity'" item.bind="labee" click.delegate="showing(labee, 'labs')" class.bind="labee.selectedClass"></icon-base>
            </div>
          </div>
        </section>
        <section if.bind="viewPane.main == 'entities' && !viewPlayer">
          <require from="resources/elements/factoryBlocks/transportLine.html" as="transport-line"></require>
          <require from="resources/elements/factoryBlocks/entityLine" as="entity-line"></require>
          <require from="resources/elements/factoryBlocks/TransportLineUpgrades.html" as="tlu"></require>
          Block Name: ${viewPane.facBlock.name}
          <div if.bind="viewPane.facBlock.inputLine">
            <p>
              Feed From: ${viewPane.facBlock.feeds[0].name}
              <span click.delegate="viewPane.facBlock.SelectBusFeed()">(Change)</span>
            </p>
            <transport-line
              if.bind="viewPane.facBlock.inputLine"
              line.bind="viewPane.facBlock.inputLine"
              inv-click.call="CC.InvXFer(inv, player.inv, {stacks: [item]})"
              type="input"
            ></transport-line>
            <tlu 
              upgrades.bind="viewPane.facBlock.upgrades.input"
              apply-upgrade.call="viewPane.facBlock.ApplyUpgrade({
                upgrade
                ,inv: player.inv
                ,line: viewPane.facBlock.inputLine
              })"
            ></tlu>
            <hr>
          </div>
          <div repeat.for="line of viewPane.facBlock.lines">
            <transport-line
              if.bind="line.items"
              line.bind="line"
              type="internal"
            ></transport-line>
            <entity-line
              if.bind="line.entities"
              line.bind="line"
            ></entity-line>
          </div>
          <div if.bind="viewPane.facBlock.outputLine">
            <hr>
            <p>
              Drains To: ${viewPane.facBlock.drains[0].name}
              <span click.delegate="viewPane.facBlock.SelectBusDrain()">(Change)</span>
            </p>
            <tlu
              upgrades.bind="viewPane.facBlock.upgrades.output"
              apply-upgrade.call="viewPane.facBlock.ApplyUpgrade({
                upgrade
                ,inv: player.inv
                ,line: viewPane.facBlock.outputLine
              })"
            ></tlu>
            <transport-line
              if.bind="viewPane.facBlock.outputLine"
              line.bind="viewPane.facBlock.outputLine"
              inv-click.call="CC.InvXFer(inv, player.inv, {stacks: [item]})"
              type="output"
            ></transport-line>
          </div>
        </section>
        <section id="menu" show.bind="viewPane.main=='menu'" style="z-index: 2000">
          <div click.delegate="resetSave()">Reset Save</div>
          <div click.delegate="resetDS()">Reset DataSource</div>
          <div click.delegate="viewPane.version = 'beta'">Beta</div>
          <div click.delegate="setDev()" if.bind="!showDev">Set Dev</div>
          <div click.delegate="unsetDev()" if.bind="showDev">Unset Dev</div>
          <div click.delegate="jumpStart()">JumpStart</div>
          <div click.delegate="testing()">Testing()</div>

        </section>
      </article>
    </div>
    <section id="inventoryList">
      <h3>Inventory</h3>
      <inventory
        items.bind="player.inv.items"
        click-call.call="player.inv.click({
          where:viewPane.facBlock, which: item
          ,who: player, what:'use'
          })"
        ></inventory>
    </section>
    <div id="tutorial">
      <div id="tut_pos" class="center">
        <span id="tut_text"></span>
        <button id="tut_button" class="center"></button>
      </div>
      <span click.delegate="hideTutorial()" note="off">X</span>
    </div>
    <section id="numSelectors">
      <input type="checkbox" id="numSelToggle" style="display:none">
      <label for="numSelToggle">Rounder&nbsp<span class="tabOnly">${mgrs.rounder.huns}${mgrs.rounder.tens}${mgrs.rounder.ones}</span>
      </label>
      <input id="huns" type="range" min="0" max="9" step="1" value.bind="mgrs.rounder.huns">
      <input id="tens" type="range" min="0" max="9" step="1" value.bind="mgrs.rounder.tens">
      <input id="ones" type="range" min="0" max="9" step="1" value.bind="mgrs.rounder.ones">
      <span>${mgrs.rounder.huns}${mgrs.rounder.tens}${mgrs.rounder.ones}</span>
      <label class="switch"><input type="checkbox" value.bind="mgrs.rounder.abs"><span class="slider text_abs_mod"></span></label>
      <label class="switch"><input type="checkbox" value.bind="mgrs.rounder.fail"><span class="slider text_full_part"></span></label>
    </section>
    <!-- section id="tagFilter">
      <input id="drawer-toggle" type="checkbox" />
      <label for="drawer-toggle" id="drawer-toggle-label">
        <span>Filters</span>
      </label>
      <div id="drawer">
        More Data!
      </div> 
    </!-->
    <!-- div id="commands" class="drawer bottom center" hidden>
      <input type="checkbox" id="show_command_drawer">
      <label class="cmd_label" for="show_command_drawer">
        <span id="cmd_text">?</span>
        <img src="" id="cmd_icon" hidden>
      </label>
      <div class="content">
        potatoes
      </div>
    </>
    </section>
  </!-->
</template>
