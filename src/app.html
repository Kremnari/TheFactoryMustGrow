<template>
  <require from="bootstrap/dist/css/bootstrap.min.css"></require>
  <require from="@fortawesome/fontawesome-free/css/all.min.css"></require>
  <require from="./styles.scss"></require>
  <require from="./tfmg.css"></require>

  <require from="resources/elements/icon-base"></require>
  <require from="resources/elements/tool-tip"></require>
  <require from="resources/value-converters/lib/ObjectFilters"></require>
  <require from="resources/value-converters/CanMine"></require>
  <require from="resources/value-converters/isVisible"></require>
  <require from="resources/value-converters/valueconverters"></require>

  <header id="selector">
    <div id="devControls" if.bind="showDev">
      <button click.delegate="save()">Save</button>
      <button click.delegate="resetSave()">Start Anew</button>
      <button click.delegate="mgrs.Ticker.toggle()">${mgrs.Ticker.isRunning ? "Pause" : "Resume"}</button>
    </div>
    <div id="playerControls">
      <h4 click.delegate="viewPane.main = 'home'">Home</h4>
      <h4 click.delegate="viewPane.main = 'entities'">Machina</h4>
      <h4 click.delegate="viewPane.main = 'facBlocks'">Blocks</h4>
      <h4 click.delegate="viewPane.main = 'research'">Research</h4>
    </div>
    <div id="facBlockControls" if.bind="!viewPane.facBlock.isPlayer" show.bind="viewPane.facBlock">
      <div show.bind="viewPane.main == 'entities'">
        <h5 click.delegate="viewPane.entityPane = 'mining'">Mining</h5>
        <h5 click.delegate="viewPane.entityPane = 'manuf'">Manufacturing</h5>
        <h5 click.delegate="viewPane.entityPane = 'labs'">Labs</h5>
      </div>
    </div>
    <tool-tip display.bind="tooltip" item-mgr.bind="mgrs.item" recipe-mgr.bind="mgrs.rec"></tool-tip>
  </header>
  <div id="mainView">
    <article class="leftside">
      <section id="recipes" show.bind="viewPane.main == 'home'">
        <h3>Crafting categories</h3>
        <div>
          <h4>Hand Craft</h4>
          <icon-base repeat.for="rec of mgrs.rec.recipes_by_cats['crafting']  | objectValues " item.bind="rec" click.delegate="mgrs.rec.startCraft(rec, player.inv, ' ')"
          show.bind="rec.enabled" class.bind="rec.classesStr" anim_class.bind="rec.style" mouseenter.trigger="tooltip = rec" mouseleave.trigger="tooltip = null"></icon-base>
        </div>
      </section>
      <section id="resources" show.bind="viewPane.main == 'home'">
        <h3>Mineables</h3>
        <icon-base repeat.for="res of mgrs.res.resList | canMine | objectValues" item.bind="res" click.delegate="mgrs.res.mine(res.name, player.inv)"
                  class="${res.mining ? 'mining': null}" anim_style.bind="res.miningStyle"></icon-base> 
      </section>
      <section id="technologies"  show.bind="viewPane.main == 'research'">
        <h3>Research</h3>
        <require from="./resources/elements/byModule/tech-infopane.html"></require>
        <tech-infopane if.bind="viewPane.showingCat=='tech'" tech.bind="viewPane.showingItem" tech-mgr.bind="mgrs.tech" tooltip.bind="tooltip"></tech-infopane>
        <icon-base repeat.for="tech of mgrs.tech.shownTechs & signal:'techUpdate'" click.delegate="showItem = {item: tech, cat: 'tech'}"
                    item.bind="tech" count.bind="tech.prerequisites.length"
                    class="${mgrs.tech.researching==tech ? 'researching' : ''} ${tech.researched ? 'researched': ''} ${viewPane.showingItem==tech ? 'selected': ''}"
        >
        </icon-base>
        <div>
          <h5>Filters</h5>
          <p>Filter Complete<button click.delegate="mgrs.tech.toggleFilter('complete')">${mgrs.tech.filters.ShowComplete? "Hide":"Show"}</button></p>
          <p>Filter Pack:
            <span repeat.for="pack of mgrs.tech.filters.ShowPack | objectEntries & signal:'techUpdate'"
              class="${pack[1]? 'selected':''}" click.delegate="mgrs.tech.toggleFilter('byPack', pack[0])"
              >
              <img src.bind="mgrs.icon.getSrc('item', pack[0])" height="16px">
            </span>
          </p>
        </div>
      </section>
      <section id="facBlocks" show.bind="viewPane.main == 'facBlocks'">
        <h3>Factory Blocks</h3>
        <div click.delegate="select_FacBlock(player, true)" class='${viewPane.facBlock==player ? "selected":""}'>player</div>
        <div repeat.for="facBlock of facBlocks" click.delegate="select_FacBlock(facBlock)" class='${viewPane.facBlock==facBlock ? "selected":""}'>
          ${facBlock.name}:${facBlock.type}
        </div>
        <div>
          <span class="button" click.delegate="add_FacBlock('factory')">Add Factory Block</span>
          <span class="button" click.delegate="add_FacBlock('bus')">Add Bus Block</span>
          <span class="button" click.delegate="add_FacBlock('resource')">Add Resource Block</span>
        </div>
      </section>
      <section id="machines" if.bind="viewPane.main == 'entities' && viewPlayer">
        <div show.bind="viewPane.entityPane == 'mining'">
          <h4>Mining</h4>
          <require from="./resources/elements/byModule/mining-infopane.html"></require>
          <mining-infopane if.bind="viewPane.showingCat=='miner'" miner.bind="viewPane.showingItem" actor.bind="player" res-mgr.bind="mgrs.res" rounder.bind="rounder"></mining-infopane>
          <div class="entityList">
            <icon-base repeat.for="miner of viewPane.entities('mining') & signal:'addedEntity'" item.bind="miner" alt-image.bind="miner.mining.icon"
                      click.delegate="showing(miner, 'miner')" class.bind="miner.selectedClass"></icon-base>
          </div>
        </div>
        <div show.bind="viewPane.entityPane == 'manuf'">
          <h4>Manufacturing</h4>
          <require from="./resources/elements/byModule/crafting-infopane.html"></require>
          <crafting-infopane if.bind="viewPane.showingCat=='crafter'" crafter.bind="viewPane.showingItem" rec-mgr.bind="mgrs.rec" item-mgr.bind="mgrs.item" inventory.bind="viewPane.facBlock.inv" rounder.bind="rounder"></crafting-infopane>
          <div class="entityList">
            <icon-base repeat.for="crafter of viewPane.entities('crafting') & signal:'addedEntity'" item.bind="crafter" alt-image.bind="crafter.recipe.icon" click.delegate="showing(crafter, 'crafter')" class.bind="crafter.selectedClass"></icon-base>
          </div>
        </div>
        <div show.bind="viewPane.entityPane == 'labs'">
          <h4>Labs</h4>
          <require from="./resources/elements/byModule/lab-infopane.html"></require>
          <lab-infopane if.bind="viewPane.showingCat=='labs'" lab.bind="viewPane.showingItem" item-mgr.bind="mgrs.item" rounder.bind="rounder"></lab-infopane>
          <div class="entityList">
            <icon-base repeat.for="labee of viewPane.entities('lab') & signal:'addedEntity'" item.bind="labee" click.delegate="showing(labee, 'labs')" class.bind="labee.selectedClass"></icon-base>
          </div>
        </div>
      </section>
      <section if.bind="viewPane.main == 'entities' && !viewPlayer">
        <require from="resources/elements/factoryBlocks/transportLine.html" as="transport-line"></require>
        <require from="resources/elements/factoryBlocks/entityLine.html" as="entity-line"></require>
        <div repeat.for="line of viewPane.facBlock.lines">
          <transport-line if.bind="line.constructor.name=='TransportLine'" line.bind="line" type.bind="($first && 'input') || ($last && 'output') || 'internal'"></transport-line>
          <entity-line if.bind="line.constructor.name=='EntityStorage'" line.bind="line"></entity-line>
        </div>
      </section>
    </article>
    <article class="rightside">
      <section id="inventoryList" if.bind="!viewPane.facBlock.isPlayer">
        <h3>Inventory</h3>
        <icon-base repeat.for="item of viewPane.facBlock.inv.items" item.bind="item" show.bind="item.count>0" count.bind="item.count" click.delegate="viewPane.facBlock.inv.click({where:viewPane.facBlock, which:item, who:player, what:'move', rounder})">
        </icon-base>
      </section>
    </article>
  </div>
  <section id="inventoryList">
    <h3>Inventory</h3>
    <icon-base repeat.for="item of player.inv.items" item.bind="item" show.bind="item.count>0" count.bind="item.count" click.delegate="player.inv.click({where:viewPane.facBlock, which:item, who:player, what:'use'})">
    </icon-base>
  </section>
  <section id="numSelectors">
    <input type="checkbox" id="numSelToggle" style="display:none">
    <label for="numSelToggle">Rounder&nbsp<span class="tabOnly">${rounder.huns}${rounder.tens}${rounder.ones}</span>
    </label>
    <input id="huns" type="range" min="0" max="9" step="1" value.bind="rounder.huns">
    <input id="tens" type="range" min="0" max="9" step="1" value.bind="rounder.tens">
    <input id="ones" type="range" min="0" max="9" step="1" value.bind="rounder.ones">
    <span>${rounder.huns}${rounder.tens}${rounder.ones}</span>
    <label class="switch"><input type="checkbox" value.bind="rounder.abs"><span class="slider text_abs_mod"></span></label>
    <label class="switch"><input type="checkbox" value.bind="rounder.fail"><span class="slider text_full_part"></span></label>
  </section>

</template>
